#!/bin/bash

# Super Student Game Launcher - Cross-Platform
# Works on Windows (via Git Bash/WSL), macOS, and Linux

# --- Color Codes for Output ---
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
NC='\033[0m' # No Color

# --- Helper Functions ---
print_status() { echo -e "${CYAN}[INFO]${NC} $1"; }
print_success() { echo -e "${GREEN}[SUCCESS]${NC} $1"; }
print_error() { echo -e "${RED}[ERROR]${NC} $1"; }
command_exists() { command -v "$1" >/dev/null 2>&1; }

# --- Main Script ---
main() {
    echo -e "${PURPLE}================================${NC}"
    echo -e "${PURPLE}ðŸŽ® Super Student Game Launcher${NC}"
    echo -e "${PURPLE}================================${NC}"

    # 1. Check for package.json
    if [ ! -f "package.json" ]; then
        print_error "package.json not found! Please run this script from the game's root directory."
        exit 1
    fi

    # 2. Check for Node.js
    print_status "Checking for Node.js..."
    if ! command_exists node; then
        print_error "Node.js is not installed. Please install it from https://nodejs.org/"
        exit 1
    fi
    print_success "Node.js found: $(node --version)"

    # 3. Install/Update Dependencies
    print_status "Installing/updating dependencies (npm install)..."
    if npm install --silent; then
        print_success "Dependencies are up to date."
    else
        print_error "npm install failed. Please check your connection and logs."
        exit 1
    fi

    # 4. Start the Game Server
    print_status "Starting the Vite development server..."
    
    # Use 'start' on Windows, 'xdg-open' on Linux, 'open' on macOS
    if [[ "$OSTYPE" == "msys" || "$OSTYPE" == "cygwin" ]]; then
        start http://localhost:5173
    elif [[ "$OSTYPE" == "linux-gnu"* ]]; then
        xdg-open http://localhost:5173 &>/dev/null &
    elif [[ "$OSTYPE" == "darwin"* ]]; then
        open http://localhost:5173
    fi

    npm run dev
}

# --- Execute Main Function ---
main "$@"
