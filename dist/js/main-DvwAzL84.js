var t=Object.defineProperty,e=(e,s,i)=>((e,s,i)=>s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[s]=i)(e,"symbol"!=typeof s?s+"":s,i);!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver(t=>{for(const s of t)if("childList"===s.type)for(const t of s.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)}).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();class s{constructor(){this.fonts={},this.images={},this.audio={}}async loadFont(t,e){const s=new FontFace(t,`url(${e})`);await s.load(),document.fonts.add(s),this.fonts[t]=s}async loadImage(t,e){return new Promise((s,i)=>{const a=new Image;a.onload=()=>{this.images[t]=a,s(a)},a.onerror=i,a.src=e})}async loadAudio(t,e){return new Promise((s,i)=>{const a=new Audio;a.oncanplaythrough=()=>{this.audio[t]=a,s(a)},a.onerror=i,a.src=e})}async initializeGameResources(){try{await this.loadFont("TitleFont","assets/fonts/title.ttf")}catch(t){console.warn("Could not load title font, using fallback")}try{await this.loadFont("SubtitleFont","assets/fonts/subtitle.ttf")}catch(t){console.warn("Could not load subtitle font, using fallback")}try{await this.loadFont("BodyFont","assets/fonts/body.ttf")}catch(t){console.warn("Could not load body font, using fallback")}try{await this.loadImage("placeholder","assets/images/placeholder.svg")}catch(t){console.warn("Could not load placeholder image")}try{await this.loadAudio("laser","assets/sounds/laser.mp3")}catch(t){console.warn("Could not load laser sound")}try{await this.loadAudio("completion","assets/sounds/completion.mp3")}catch(t){console.warn("Could not load completion sound")}try{await this.loadAudio("ambient_space","assets/sounds/ambient_space.mp3")}catch(t){console.warn("Could not load ambient space sound")}return{fonts:this.fonts,images:this.images,audio:this.audio}}setDisplayMode(t){localStorage.setItem("displayMode",t)}getDisplayMode(){return localStorage.getItem("displayMode")||"DEFAULT"}testResourceLoading(){return console.log("Testing resource loading..."),console.log("Loaded fonts:",Object.keys(this.fonts)),console.log("Loaded images:",Object.keys(this.images)),console.log("Loaded audio:",Object.keys(this.audio)),this.images.placeholder?(console.log("‚úì Placeholder image loaded successfully"),console.log("  - Width:",this.images.placeholder.width||"Not loaded yet"),console.log("  - Height:",this.images.placeholder.height||"Not loaded yet")):console.log("‚úó Placeholder image not loaded"),{fontsCount:Object.keys(this.fonts).length,imagesCount:Object.keys(this.images).length,audioCount:Object.keys(this.audio).length}}}class i{constructor(t=500){this.maxParticles=t,this.particles=[],this.lastUpdateTime=performance.now(),this.particlePool=[],this.activeParticles=0,this.lastCleanupTime=0,this.cleanupInterval=100,this.renderBatch=[],this.colorCache=new Map,this.globalEffects={wind:{x:0,y:0},gravity:.1,turbulence:0},this.performanceMode="high",this.frameTimeHistory=[],this.avgFrameTime=16,this.initializePool()}initializePool(){for(let t=0;t<this.maxParticles;t++)this.particlePool.push(this.createParticleObject())}createParticleObject(){return{x:0,y:0,vx:0,vy:0,size:1,color:"#ffffff",opacity:1,life:1,maxLife:1e3,age:0,rotation:0,rotationSpeed:0,scale:1,scaleVelocity:0,active:!1,type:"circle",trail:!1,trailPositions:[],physics:{gravity:!0,bounce:!1,friction:.99}}}setPerformanceMode(t){switch(this.performanceMode=t,t){case"low":this.maxParticles=Math.min(100,this.maxParticles),this.cleanupInterval=200;break;case"medium":this.maxParticles=Math.min(250,this.maxParticles),this.cleanupInterval=150}}createParticle(t,e,s,i,a,n,o,r={}){if(this.activeParticles>=this.maxParticles&&(this.removeOldestParticle(),this.activeParticles>=this.maxParticles))return null;let h=this.particlePool.find(t=>!t.active);return h||(h=this.createParticleObject(),this.particlePool.push(h)),h.x=t,h.y=e,h.vx=a,h.vy=n,h.size=i,h.color=s,h.opacity=r.opacity||1,h.life=1,h.maxLife=o,h.age=0,h.rotation=r.rotation||0,h.rotationSpeed=r.rotationSpeed||0,h.scale=r.scale||1,h.scaleVelocity=r.scaleVelocity||0,h.active=!0,h.type=r.type||"circle",h.trail=r.trail||!1,h.trailPositions=[],h.physics.gravity=void 0===r.gravity||r.gravity,h.physics.bounce=r.bounce||!1,h.physics.friction=r.friction||.99,this.particles.includes(h)||this.particles.push(h),this.activeParticles++,h}createExplosion(t,e,s,i=1,a=20){for(let n=0;n<a*i;n++){const o=2*Math.PI*n/(a*i),r=2+4*Math.random()*i,h=1+3*Math.random()*i,c=500+1e3*Math.random();this.createParticle(t,e,s,h,Math.cos(o)*r,Math.sin(o)*r,c,{scaleVelocity:-.01,rotationSpeed:.2*(Math.random()-.5),gravity:!0})}}createTrail(t,e,s,i,a,n,o){this.createParticle(t,e,s,i,a,n,o,{trail:!0,gravity:!1,friction:.95,scaleVelocity:-.005})}createSparkle(t,e,s,i=1){const a=5+Math.floor(10*Math.random()*i);for(let n=0;n<a;n++){const a=Math.random()*Math.PI*2,n=.5+2*Math.random()*i,o=1+2*Math.random(),r=800+600*Math.random();this.createParticle(t+20*(Math.random()-.5),e+20*(Math.random()-.5),s,o,Math.cos(a)*n,Math.sin(a)*n,r,{type:"star",rotationSpeed:.3*(Math.random()-.5),scaleVelocity:-.003,gravity:!1})}}createBubbleParticles(t,e,s=10){for(let i=0;i<s;i++){const s=Math.random()*Math.PI*2,i=.5+1.5*Math.random(),a=2+4*Math.random(),n=1e3+2e3*Math.random();this.createParticle(t,e,`hsla(${200+60*Math.random()}, 70%, 80%, 0.7)`,a,Math.cos(s)*i,Math.sin(s)*i-1,n,{type:"bubble",gravity:!1,friction:.98,scaleVelocity:.001})}}removeOldestParticle(){let t=-1,e=0;for(let s=0;s<this.particles.length;s++)this.particles[s].active&&this.particles[s].age>e&&(e=this.particles[s].age,t=s);t>=0&&this.deactivateParticle(this.particles[t])}deactivateParticle(t){t.active=!1,t.trailPositions=[],this.activeParticles--}updateAndDraw(t,e){const s=performance.now(),i=void 0!==e?e:16;this.updateParticles(i),s-this.lastCleanupTime>this.cleanupInterval&&(this.cleanupInactiveParticles(),this.lastCleanupTime=s),this.drawParticles(t),this.monitorPerformance(s)}updateParticles(t){const e=t/16;for(let s=0;s<this.particles.length;s++){const i=this.particles[s];i.active&&(i.age+=t,i.life=1-i.age/i.maxLife,i.life<=0?this.deactivateParticle(i):(i.trail&&(i.trailPositions.push({x:i.x,y:i.y}),i.trailPositions.length>10&&i.trailPositions.shift()),this.updateParticlePhysics(i,e),this.updateParticleVisuals(i,e)))}}updateParticlePhysics(t,e){t.vx+=this.globalEffects.wind.x*e,t.vy+=this.globalEffects.wind.y*e,t.physics.gravity&&(t.vy+=this.globalEffects.gravity*e),this.globalEffects.turbulence>0&&(t.vx+=(Math.random()-.5)*this.globalEffects.turbulence*e,t.vy+=(Math.random()-.5)*this.globalEffects.turbulence*e),t.vx*=t.physics.friction,t.vy*=t.physics.friction,t.x+=t.vx*e,t.y+=t.vy*e,t.physics.bounce&&((t.x<0||t.x>800)&&(t.vx*=-.5),t.y>600&&(t.vy*=-.5,t.y=600))}updateParticleVisuals(t,e){t.rotation+=t.rotationSpeed*e,t.scale+=t.scaleVelocity*e,t.scale=Math.max(.1,t.scale),t.opacity=t.life}drawParticles(t){const e={circle:[],star:[],bubble:[],trail:[]};for(let s=0;s<this.particles.length;s++){const t=this.particles[s];t.active&&(e[t.type]?e[t.type].push(t):e.circle.push(t))}t.save(),this.drawTrailParticles(t,e.trail),this.drawCircleParticles(t,e.circle),this.drawStarParticles(t,e.star),this.drawBubbleParticles(t,e.bubble),t.restore()}drawCircleParticles(t,e){e.forEach(e=>{t.save(),t.globalAlpha=e.opacity,t.translate(e.x,e.y),t.scale(e.scale,e.scale),t.rotate(e.rotation),t.fillStyle=e.color,t.beginPath(),t.arc(0,0,e.size,0,2*Math.PI),t.fill(),t.restore()})}drawStarParticles(t,e){e.forEach(e=>{t.save(),t.globalAlpha=e.opacity,t.translate(e.x,e.y),t.scale(e.scale,e.scale),t.rotate(e.rotation),t.fillStyle=e.color,t.beginPath();for(let s=0;s<5;s++){const i=s*Math.PI*2/5,a=Math.cos(i)*e.size,n=Math.sin(i)*e.size;0===s?t.moveTo(a,n):t.lineTo(a,n)}t.closePath(),t.fill(),t.restore()})}drawBubbleParticles(t,e){e.forEach(e=>{t.save(),t.globalAlpha=e.opacity,t.translate(e.x,e.y),t.scale(e.scale,e.scale);const s=t.createRadialGradient(.3*-e.size,.3*-e.size,0,0,0,e.size);s.addColorStop(0,"rgba(255, 255, 255, 0.8)"),s.addColorStop(.7,e.color),s.addColorStop(1,"rgba(255, 255, 255, 0.2)"),t.fillStyle=s,t.beginPath(),t.arc(0,0,e.size,0,2*Math.PI),t.fill(),t.fillStyle="rgba(255, 255, 255, 0.6)",t.beginPath(),t.arc(.3*-e.size,.3*-e.size,.3*e.size,0,2*Math.PI),t.fill(),t.restore()})}drawTrailParticles(t,e){e.forEach(e=>{if(!(e.trailPositions.length<2)){t.save(),t.globalAlpha=.5*e.opacity,t.strokeStyle=e.color,t.lineWidth=e.size,t.lineCap="round",t.lineJoin="round",t.beginPath(),t.moveTo(e.trailPositions[0].x,e.trailPositions[0].y);for(let s=1;s<e.trailPositions.length;s++)t.lineTo(e.trailPositions[s].x,e.trailPositions[s].y);t.stroke(),t.restore(),t.save(),t.globalAlpha=e.opacity,t.fillStyle=e.color,t.beginPath(),t.arc(e.x,e.y,e.size,0,2*Math.PI),t.fill(),t.restore()}})}cleanupInactiveParticles(){this.particles=this.particles.filter(t=>t.active)}monitorPerformance(t){const e=t-(this.lastFrameTime||t);if(this.frameTimeHistory.push(e),this.frameTimeHistory.length>60){this.frameTimeHistory.shift();const t=this.frameTimeHistory.reduce((t,e)=>t+e,0);this.avgFrameTime=t/this.frameTimeHistory.length,this.avgFrameTime>20&&"high"===this.performanceMode?(this.setPerformanceMode("medium"),console.log("üêå Reduced to medium performance mode")):this.avgFrameTime>25&&"medium"===this.performanceMode?(this.setPerformanceMode("low"),console.log("üêå Reduced to low performance mode")):this.avgFrameTime<17&&"high"!==this.performanceMode&&(this.setPerformanceMode("high"),console.log("üöÄ Increased to high performance mode"))}this.lastFrameTime=t}setWind(t,e){this.globalEffects.wind.x=t,this.globalEffects.wind.y=e}setGravity(t){this.globalEffects.gravity=t}setTurbulence(t){this.globalEffects.turbulence=t}clear(){this.particles.forEach(t=>this.deactivateParticle(t)),this.activeParticles=0}getActiveParticleCount(){return this.activeParticles}getPerformanceInfo(){return{activeParticles:this.activeParticles,maxParticles:this.maxParticles,avgFrameTime:this.avgFrameTime,performanceMode:this.performanceMode,fps:Math.round(1e3/this.avgFrameTime)}}}const a=Object.freeze({DISPLAY_MODES:Object.freeze(["DEFAULT","QBOARD"]),DEFAULT_MODE:"DEFAULT",FONT_SIZES:Object.freeze({DEFAULT:Object.freeze({regular:24,large:48}),QBOARD:Object.freeze({regular:30,large:60})}),MAX_PARTICLES:Object.freeze({DEFAULT:100,QBOARD:150}),MAX_EXPLOSIONS:Object.freeze({DEFAULT:5,QBOARD:8}),MAX_SWIRL_PARTICLES:Object.freeze({DEFAULT:30,QBOARD:15}),MOTHER_RADIUS:Object.freeze({DEFAULT:90,QBOARD:120}),COLORS:Object.freeze({WHITE:Object.freeze([255,255,255]),BLACK:Object.freeze([0,0,0]),FLAME_COLORS:Object.freeze([Object.freeze([255,69,0]),Object.freeze([255,215,0]),Object.freeze([0,191,255])]),COLORS_LIST:Object.freeze([Object.freeze([0,0,255]),Object.freeze([255,0,0]),Object.freeze([0,200,0]),Object.freeze([255,255,0]),Object.freeze([128,0,255])])}),SEQUENCES:Object.freeze({alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),numbers:Object.freeze(["1","2","3","4","5","6","7","8","9","10"]),clcase:"abcdefghijklmnopqrstuvwxyz".split(""),shapes:Object.freeze(["Circle","Square","Triangle","Rectangle","Pentagon"]),colors:Object.freeze(["Blue","Red","Green","Yellow","Purple"])}),LETTER_SPAWN_INTERVAL:60,GROUP_SIZE:5,COLORS_COLLISION_DELAY:250,TOUCH_COOLDOWN:50,DOT_RADIUS:48,DOT_SPEED_RANGE:Object.freeze([3,6]),EXPLOSION_EXPANSION_RATE:.1,SCREEN_SHAKE_DURATION:10,SPATIAL_GRID_SIZE:120,COLLISION_CHECK_FREQUENCY:Object.freeze({DEFAULT:1,QBOARD:2}),CULLING_DISTANCE_MULTIPLIER:1,COLORS_LEVEL_CONFIG:Object.freeze({TOTAL_DOTS:85,TARGET_DOTS:17,DISTRACTOR_DOTS:68,DISPERSION_FRAMES:30,DOT_BOUNCE_DAMPENING:.98,SHIMMER_FREQUENCY:.05,GLOW_FREQUENCY:.1,MEMORY_DISPLAY_TIME:2e3,COLLISION_ENABLED_DELAY:250,GRID_OPTIMIZATION:!0}),TEXT_LEVEL_CONFIG:Object.freeze({CENTER_FONT_SIZE:900,FALLING_FONT_SIZE:240,SPAWN_EDGE_BUFFER:50,TARGET_ADVANCE_COUNT:5,CHECKPOINT_INTERVAL:5,ABILITIES:Object.freeze(["laser","aoe","charge_up"]),AOE_RADIUS:200,CHARGE_UP_DURATION:60,LASER_WIDTH:Object.freeze([3,5]),SWIRL_PARTICLE_COUNT:30,CENTER_PIECE_ORBIT_RADIUS:100}),AUDIO_CONFIG:Object.freeze({MASTER_VOLUME:.7,SFX_VOLUME:.8,MUSIC_VOLUME:.3,SOUNDS:Object.freeze({laser:Object.freeze({file:"laser.mp3",volume:.6}),completion:Object.freeze({file:"completion.mp3",volume:1})}),AMBIENT:Object.freeze({space:Object.freeze({file:"ambient_space.mp3",volume:.2,loop:!0})}),WEB_AUDIO_CONTEXT:!0,BUFFER_PRELOAD:!0})});function n(){return{masterVolume:a.AUDIO_CONFIG?.MASTER_VOLUME??.7,sfxVolume:a.AUDIO_CONFIG?.SFX_VOLUME??.8,musicVolume:a.AUDIO_CONFIG?.MUSIC_VOLUME??.3,sounds:a.AUDIO_CONFIG?.SOUNDS??{},ambient:a.AUDIO_CONFIG?.AMBIENT??{},webAudioContext:a.AUDIO_CONFIG?.WEB_AUDIO_CONTEXT??!0,bufferPreload:a.AUDIO_CONFIG?.BUFFER_PRELOAD??!0}}class o{constructor(){const t=n();this.audioContext=new(window.AudioContext||window.webkitAudioContext),this._volume=t.masterVolume,this.masterGain=this.audioContext.createGain(),this.masterGain.gain.value=this._volume,this.masterGain.connect(this.audioContext.destination),this.gains={sfx:this.audioContext.createGain(),music:this.audioContext.createGain(),ambient:this.audioContext.createGain(),phonics:this.audioContext.createGain()},this.gains.sfx.gain.value=t.sfxVolume,this.gains.music.gain.value=t.musicVolume,this.gains.ambient.gain.value=t.musicVolume,this.gains.phonics.gain.value=t.sfxVolume,Object.values(this.gains).forEach(t=>t.connect(this.masterGain)),this.buffers={},this.activeSources={},this.sounds={},this.sounds={},this.phonicsCache=new Map,this.soundQueue=[],this.isProcessingQueue=!1,this.maxConcurrentSounds=8,this.activeSoundsCount=0,this.initializeDefaultSounds()}initializeDefaultSounds(){this.createSyntheticSounds()}createSyntheticSounds(){const t=this.audioContext.sampleRate,e=this.audioContext.createBuffer(1,.1*t,t),s=e.getChannelData(0);for(let c=0;c<s.length;c++){const e=c/t;s[c]=Math.sin(2*Math.PI*800*e)*Math.exp(20*-e)*.3}this.buffers.pop={buffer:e,type:"sfx"};const i=this.audioContext.createBuffer(1,.3*t,t),a=i.getChannelData(0);for(let c=0;c<a.length;c++){const e=c/t,s=Math.exp(3*-e);a[c]=(.3*Math.sin(2*Math.PI*440*e)+.2*Math.sin(2*Math.PI*554*e)+.1*Math.sin(2*Math.PI*659*e))*s}this.buffers.success={buffer:i,type:"sfx"};const n=this.audioContext.createBuffer(1,.2*t,t),o=n.getChannelData(0);for(let c=0;c<o.length;c++){const e=c/t;o[c]=Math.sin(2*Math.PI*150*e)*Math.exp(10*-e)*.4}this.buffers.wrong={buffer:n,type:"sfx"};const r=this.audioContext.createBuffer(1,.4*t,t),h=r.getChannelData(0);for(let c=0;c<h.length;c++){const e=c/t,s=2*(Math.random()-.5),i=Math.exp(5*-e);h[c]=s*i*.3}this.buffers.explosion={buffer:r,type:"sfx"}}async loadSound(t,e,s="sfx"){try{const i=await fetch(e),a=await i.arrayBuffer(),n=await this.audioContext.decodeAudioData(a);return this.buffers[t]={buffer:n,type:s},this.sounds[t]=n,n}catch(i){return console.warn(`Failed to load sound ${t}:`,i),null}}playSound(t,e=1,s=1){if(this.activeSoundsCount>=this.maxConcurrentSounds)return null;const i=this.buffers[t];if(!i)return console.warn(`Sound ${t} not found`),null;const a=this.audioContext.createBufferSource();a.buffer=i.buffer;const n=this.audioContext.createGain();return n.gain.value=e,a.connect(n),n.connect(this.gains[i.type]||this.gains.sfx),a.playbackRate.value=s,a.start(0),this.activeSoundsCount++,a.onended=()=>{this.activeSoundsCount--},a}playPhonicsSound(t,e=1){const s=`phonics_${t.toLowerCase()}`;return this.phonicsCache.has(s)?this.playSound(s,e):this.generateSyntheticPhonicsSound(t,e)}generateSyntheticPhonicsSound(t,e=1){const s=this.audioContext.sampleRate,i=this.audioContext.createBuffer(1,.5*s,s),a=i.getChannelData(0),n={a:[800,1200],b:[100,200],c:[200,300],d:[150,250],e:[500,700],f:[300,400],g:[120,220],h:[100,150],i:[300,500],j:[200,400],k:[250,350],l:[400,600],m:[150,300],n:[200,400],o:[400,600],p:[100,200],q:[250,450],r:[300,500],s:[500,800],t:[400,600],u:[300,500],v:[200,400],w:[250,450],x:[300,600],y:[400,700],z:[400,800]}[t.toLowerCase()]||[400,600];for(let r=0;r<a.length;r++){const t=r/s,i=Math.exp(2*-t)*(1-Math.exp(10*-t));a[r]=(.3*Math.sin(2*Math.PI*n[0]*t)+.2*Math.sin(2*Math.PI*n[1]*t))*i*e}const o=`phonics_${t.toLowerCase()}`;return this.buffers[o]={buffer:i,type:"phonics"},this.phonicsCache.set(o,i),this.playSound(o,e)}playMusic(t,e=!0,s=1){const i=this.buffers[t];if(!i)return null;this.activeSources[t]&&this.activeSources[t].stop();const a=this.audioContext.createBufferSource();a.buffer=i.buffer,a.loop=e;const n=this.audioContext.createGain();return n.gain.value=s,a.connect(n),n.connect(this.gains.music),a.start(0),this.activeSources[t]=a,a}playAmbient(t,e=!0,s=1){const i=this.buffers[t];if(!i)return null;this.activeSources[t]&&this.activeSources[t].stop();const a=this.audioContext.createBufferSource();a.buffer=i.buffer,a.loop=e;const n=this.audioContext.createGain();return n.gain.value=s,a.connect(n),n.connect(this.gains.ambient),a.start(0),this.activeSources[t]=a,a}playExplosion(t=1){return this.playSound("explosion",t,.8+.4*Math.random())}playPop(t=1){return this.playSound("pop",t,.9+.2*Math.random())}playSuccess(){return this.playSound("success",1)}playWrong(){return this.playSound("wrong",1)}playSequence(t,e=200){this.soundQueue.push({sounds:t,delay:e}),this.isProcessingQueue||this.processQueue()}async processQueue(){for(this.isProcessingQueue=!0;this.soundQueue.length>0;){const{sounds:t,delay:e}=this.soundQueue.shift();for(let s=0;s<t.length;s++){const i=t[s];"string"==typeof i?this.playSound(i):"phonics"===i.type?this.playPhonicsSound(i.letter,i.volume):"sound"===i.type&&this.playSound(i.name,i.volume,i.pitch),s<t.length-1&&await new Promise(t=>setTimeout(t,e))}}this.isProcessingQueue=!1}stop(t){const e=this.activeSources[t];e&&(e.stop(),delete this.activeSources[t])}stopAll(){Object.values(this.activeSources).forEach(t=>{t&&"function"==typeof t.stop&&t.stop()}),this.activeSources={},this.activeSoundsCount=0}setMasterVolume(t){this._volume=t,this.masterGain&&(this.masterGain.gain.value=t)}setCategoryVolume(t,e){this.gains[t]&&(this.gains[t].gain.value=e)}setGlobalVolume(t){this.setMasterVolume(t)}get volume(){return this._volume}set volume(t){this.setMasterVolume(t)}async resumeContext(){"suspended"===this.audioContext.state&&await this.audioContext.resume()}fadeCategoryVolume(t,e,s=500){const i=this.gains[t]||this.masterGain,a=this.audioContext.currentTime;i.gain.cancelScheduledValues(a),i.gain.setValueAtTime(i.gain.value,a),i.gain.linearRampToValueAtTime(e,a+s/1e3)}mute(){this.setMasterVolume(0)}unmute(){const{masterVolume:t}=n();this.setMasterVolume(t)}toggleMute(){this.masterGain.gain.value>0?this.mute():this.unmute()}createDynamicSound(t,e,s="sine",i=.3){const a=this.audioContext.createOscillator(),n=this.audioContext.createGain();return a.type=s,a.frequency.value=t,n.gain.value=i,n.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+e),a.connect(n),n.connect(this.gains.sfx),a.start(),a.stop(this.audioContext.currentTime+e),a}getAudioContext(){return this.audioContext}hasSounds(){return Object.keys(this.buffers).length>0}getAvailableSounds(){return Object.keys(this.buffers)}}class r{constructor(t){this.canvas=t,this.ctx=t.getContext("2d"),this.setupCanvas()}setupCanvas(){const{width:t,height:e}=this.canvas.getBoundingClientRect();this.canvas.width=t*(window.devicePixelRatio||1),this.canvas.height=e*(window.devicePixelRatio||1),this.canvas.style.width=t+"px",this.canvas.style.height=e+"px",this.ctx.scale(window.devicePixelRatio||1,window.devicePixelRatio||1)}clear(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}}class h{constructor(t,e){this.updateFn=t,this.renderFn=e,this.lastTime=0,this.running=!1}start(){this.running=!0,this.lastTime=performance.now(),this._loop()}stop(){this.running=!1}_loop(){if(!this.running)return;const t=performance.now(),e=t-this.lastTime;this.lastTime=t,this.lastDeltaTime=e,this.updateFn(e),this.renderFn(),requestAnimationFrame(()=>this._loop())}}class c{constructor(t,e){this.canvas=t,this.ctx=e,this.score=0,this.level=1,this.lives=3,this.abilities={flamethrower:{cooldown:0,maxCooldown:5e3},explosion:{cooldown:0,maxCooldown:3e3}},this.fontSize=.03*Math.min(t.width,t.height)}updateScore(t){this.score+=t}updateLevel(t){this.level=t}updateLives(t){this.lives=t}updateAbilityCooldown(t,e){this.abilities[t]&&(this.abilities[t].cooldown=Math.max(0,e))}isAbilityReady(t){return 0===this.abilities[t]?.cooldown}draw(){this.ctx.save(),this.ctx.fillStyle="#FFFFFF",this.ctx.font=`${this.fontSize}px Arial`,this.ctx.textAlign="left",this.ctx.fillText(`Score: ${this.score}`,20,40),this.ctx.fillText(`Level: ${this.level}`,20,80),this.ctx.fillText(`Lives: ${this.lives}`,20,120);let t=160;Object.entries(this.abilities).forEach(([e,s])=>{const i=s.cooldown/s.maxCooldown,a=i>0?"#FF6B6B":"#4ECDC4";this.ctx.fillStyle=a,this.ctx.fillText(`${e}: ${i>0?(s.cooldown/1e3).toFixed(1)+"s":"Ready"}`,20,t),t+=40}),this.ctx.restore()}update(t){Object.values(this.abilities).forEach(e=>{e.cooldown>0&&(e.cooldown=Math.max(0,e.cooldown-t))})}resize(t){this.canvas=t,this.fontSize=.03*Math.min(t.width,t.height)}}class l{constructor(t,e){this.canvas=t,this.ctx=e,this.isActive=!1,this.currentMessage="",this.fadeAlpha=0,this.fadeDirection=1,this.displayTime=0,this.maxDisplayTime=3e3}showCheckpoint(t){this.isActive=!0,this.currentMessage=t,this.fadeAlpha=0,this.fadeDirection=1,this.displayTime=0}update(t){this.isActive&&(this.displayTime+=t,1===this.fadeDirection?(this.fadeAlpha+=.003*t,this.fadeAlpha>=1&&(this.fadeAlpha=1,this.fadeDirection=0)):0===this.fadeDirection?this.displayTime>.7*this.maxDisplayTime&&(this.fadeDirection=-1):-1===this.fadeDirection&&(this.fadeAlpha-=.003*t,this.fadeAlpha<=0&&(this.fadeAlpha=0,this.isActive=!1)))}draw(){if(!this.isActive||0===this.fadeAlpha)return;this.ctx.save(),this.ctx.fillStyle=`rgba(0, 0, 0, ${.5*this.fadeAlpha})`,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);const t=.08*Math.min(this.canvas.width,this.canvas.height);this.ctx.font=`${t}px Arial`,this.ctx.fillStyle=`rgba(255, 255, 255, ${this.fadeAlpha})`,this.ctx.textAlign="center",this.ctx.textBaseline="middle";const e=this.canvas.width/2,s=this.canvas.height/2;this.ctx.shadowColor="#4ECDC4",this.ctx.shadowBlur=20*this.fadeAlpha,this.ctx.fillText(this.currentMessage,e,s);const i=.4*t;this.ctx.font=`${i}px Arial`,this.ctx.shadowBlur=10*this.fadeAlpha,this.ctx.fillText("Checkpoint Reached!",e,s+t),this.ctx.restore()}isDisplaying(){return this.isActive}skipCheckpoint(){this.isActive=!1,this.fadeAlpha=0}}class d{constructor(t,e,s){this.canvas=t,this.ctx=e,this.particleManager=s,this.activeFlames=[],this.maxFlames=10}createFlamethrower(t,e,s,i,a="#FF6B6B",n=1e3){if(this.activeFlames.length>=this.maxFlames)return;const o={startX:t,startY:e,endX:s,endY:i,color:a,duration:n,age:0,intensity:1,particles:[]};this.activeFlames.push(o),this.generateFlameParticles(o)}generateFlameParticles(t){const e=Math.sqrt(Math.pow(t.endX-t.startX,2)+Math.pow(t.endY-t.startY,2)),s=Math.min(Math.floor(e/10),50);for(let i=0;i<s;i++){const e=i/s,a=t.startX+(t.endX-t.startX)*e,n=t.startY+(t.endY-t.startY)*e,o=20*(Math.random()-.5),r=20*(Math.random()-.5),h=2*(Math.random()-.5),c=2*(Math.random()-.5),l=["#FF6B6B","#FF8E53","#FF6B35","#FFD93D"],d=l[Math.floor(Math.random()*l.length)];this.particleManager.createParticle(a+o,n+r,d,4*Math.random()+2,h,c,500+500*Math.random())}}update(t){this.activeFlames=this.activeFlames.filter(e=>(e.age+=t,e.intensity=Math.max(0,1-e.age/e.duration),e.intensity>.3&&Math.random()<.1&&this.generateFlameParticles(e),e.age<e.duration))}draw(){this.ctx.save(),this.activeFlames.forEach(t=>{t.intensity<=0||(this.ctx.globalAlpha=.8*t.intensity,this.ctx.strokeStyle=t.color,this.ctx.lineWidth=4*t.intensity,this.ctx.shadowColor=t.color,this.ctx.shadowBlur=10*t.intensity,this.ctx.beginPath(),this.ctx.moveTo(t.startX,t.startY),this.ctx.lineTo(t.endX,t.endY),this.ctx.stroke(),this.ctx.globalAlpha=t.intensity,this.ctx.strokeStyle="#FFFFFF",this.ctx.lineWidth=2*t.intensity,this.ctx.shadowBlur=5*t.intensity,this.ctx.beginPath(),this.ctx.moveTo(t.startX,t.startY),this.ctx.lineTo(t.endX,t.endY),this.ctx.stroke())}),this.ctx.restore()}checkCollision(t,e,s){return this.activeFlames.some(i=>{if(i.intensity<=0)return!1;const a=i.endY-i.startY,n=i.startX-i.endX,o=i.endX*i.startY-i.startX*i.endY;return Math.abs(a*t+n*e+o)/Math.sqrt(a*a+n*n)<=s})}clear(){this.activeFlames=[]}}class u{constructor(t,e,s){this.canvas=t,this.ctx=e,this.particleManager=s,this.centerX=t.width/2,this.centerY=t.height/2,this.radius=Math.max(10,.1*Math.min(t.width,t.height)),this.rotation=0,this.pulsePhase=0,this.swirlParticles=[],this.lastParticleTime=0}update(t){this.rotation+=.002*t,this.pulsePhase+=.003*t,this.lastParticleTime+=t,this.lastParticleTime>100&&(this.generateSwirlParticle(),this.lastParticleTime=0),this.swirlParticles=this.swirlParticles.filter(e=>(e.angle+=e.speed,e.radius+=e.radiusSpeed,e.life-=t,e.x=this.centerX+Math.cos(e.angle)*e.radius,e.y=this.centerY+Math.sin(e.angle)*e.radius,e.life>0&&e.radius<this.canvas.width))}generateSwirlParticle(){const t={angle:Math.random()*Math.PI*2,radius:this.radius,radiusSpeed:.5+1*Math.random(),speed:.02+.03*Math.random(),x:this.centerX,y:this.centerY,color:this.getRandomColor(),size:2+3*Math.random(),life:3e3+2e3*Math.random()};this.swirlParticles.push(t)}getRandomColor(){const t=["#4ECDC4","#45B7D1","#96CEB4","#FECA57","#FF6B6B"];return t[Math.floor(Math.random()*t.length)]}draw(){this.ctx.save();let t=this.radius+10*Math.sin(this.pulsePhase);t<2&&(t=2),this.ctx.shadowColor="#4ECDC4",this.ctx.shadowBlur=20,this.ctx.fillStyle="rgba(78, 205, 196, 0.3)",this.ctx.beginPath(),this.ctx.arc(this.centerX,this.centerY,1.5*t,0,2*Math.PI),this.ctx.fill(),this.ctx.shadowBlur=10,this.ctx.fillStyle="#4ECDC4",this.ctx.beginPath(),this.ctx.arc(this.centerX,this.centerY,t,0,2*Math.PI),this.ctx.fill(),this.ctx.shadowBlur=5,this.ctx.fillStyle="#FFFFFF",this.ctx.beginPath(),this.ctx.arc(this.centerX,this.centerY,.6*t,0,2*Math.PI),this.ctx.fill(),this.ctx.strokeStyle="#FFFFFF",this.ctx.lineWidth=2,this.ctx.shadowBlur=8;for(let e=0;e<8;e++){const s=this.rotation+e*Math.PI/4,i=.7*t,a=1.2*t,n=this.centerX+Math.cos(s)*i,o=this.centerY+Math.sin(s)*i,r=this.centerX+Math.cos(s)*a,h=this.centerY+Math.sin(s)*a;this.ctx.beginPath(),this.ctx.moveTo(n,o),this.ctx.lineTo(r,h),this.ctx.stroke()}this.swirlParticles.forEach(t=>{const e=t.life/3e3;this.ctx.globalAlpha=e,this.ctx.fillStyle=t.color,this.ctx.shadowBlur=5,this.ctx.shadowColor=t.color,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.size,0,2*Math.PI),this.ctx.fill()}),this.ctx.restore()}checkCollision(t,e,s){return Math.sqrt(Math.pow(t-this.centerX,2)+Math.pow(e-this.centerY,2))<this.radius+s}resize(t){this.canvas=t,this.centerX=t.width/2,this.centerY=t.height/2,this.radius=Math.max(10,.1*Math.min(t.width,t.height))}reset(){this.swirlParticles=[],this.rotation=0,this.pulsePhase=0}}class p{constructor(t){this.canvas=t,this.pointers=new Map,this.callbacks={pointerdown:[],pointermove:[],pointerup:[]},this._boundPointerDown=this.handlePointerDown.bind(this),this._boundPointerMove=this.handlePointerMove.bind(this),this._boundPointerUp=this.handlePointerUp.bind(this),this._boundPreventDefault=t=>t.preventDefault(),this.setupEventListeners()}setupEventListeners(){this.canvas.addEventListener("pointerdown",this._boundPointerDown),this.canvas.addEventListener("pointermove",this._boundPointerMove),this.canvas.addEventListener("pointerup",this._boundPointerUp),this.canvas.addEventListener("pointercancel",this._boundPointerUp),this.canvas.addEventListener("touchstart",this._boundPreventDefault),this.canvas.addEventListener("touchmove",this._boundPreventDefault),this.canvas.addEventListener("touchend",this._boundPreventDefault)}handlePointerDown(t){const e=this.canvas.getBoundingClientRect(),s={id:t.pointerId,x:t.clientX-e.left,y:t.clientY-e.top,startX:t.clientX-e.left,startY:t.clientY-e.top,type:t.pointerType,pressure:t.pressure||1,startTime:performance.now()};this.pointers.set(t.pointerId,s),this.triggerCallbacks("pointerdown",s,t)}handlePointerMove(t){if(!this.pointers.has(t.pointerId))return;const e=this.canvas.getBoundingClientRect(),s=this.pointers.get(t.pointerId);s.x=t.clientX-e.left,s.y=t.clientY-e.top,s.pressure=t.pressure||1,this.triggerCallbacks("pointermove",s,t)}handlePointerUp(t){if(!this.pointers.has(t.pointerId))return;const e=this.pointers.get(t.pointerId);e.endTime=performance.now(),this.triggerCallbacks("pointerup",e,t),this.pointers.delete(t.pointerId)}triggerCallbacks(t,e,s){this.callbacks[t].forEach(i=>{try{i(e,s)}catch(a){console.error(`Error in ${t} callback:`,a)}})}addEventListener(t,e){this.callbacks[t]&&this.callbacks[t].push(e)}removeEventListener(t,e){if(this.callbacks[t]){const s=this.callbacks[t].indexOf(e);s>-1&&this.callbacks[t].splice(s,1)}}getActivePointers(){return Array.from(this.pointers.values())}getPointerCount(){return this.pointers.size}getPointer(t){return this.pointers.get(t)}isMultiTouch(){return this.pointers.size>1}getPinchDistance(){const t=this.getActivePointers();if(t.length<2)return null;const[e,s]=t;return Math.sqrt(Math.pow(s.x-e.x,2)+Math.pow(s.y-e.y,2))}getPinchCenter(){const t=this.getActivePointers();if(t.length<2)return null;const[e,s]=t;return{x:(e.x+s.x)/2,y:(e.y+s.y)/2}}clear(){this.pointers.clear()}destroy(){this.canvas.removeEventListener("pointerdown",this._boundPointerDown),this.canvas.removeEventListener("pointermove",this._boundPointerMove),this.canvas.removeEventListener("pointerup",this._boundPointerUp),this.canvas.removeEventListener("pointercancel",this._boundPointerUp),this.canvas.removeEventListener("touchstart",this._boundPreventDefault),this.canvas.removeEventListener("touchmove",this._boundPreventDefault),this.canvas.removeEventListener("touchend",this._boundPreventDefault),this.clear()}}class g{constructor(t,e,s){this.canvas=t,this.ctx=e,this.particleManager=s,this.isShattered=!1,this.shatterTime=0,this.maxShatterTime=3e3,this.fadeAlpha=0,this.cracks=[],this.fragments=[],this.stressPoints=[],this.physics={gravity:.3,friction:.98,elasticity:.4,fragmentCount:25,crackPropagationSpeed:300,stressFieldRadius:150},this.effects={refractionIntensity:.8,reflectionIntensity:.6,glowIntensity:.4,shimmerPhase:0},this.performanceLevel=this.detectPerformanceLevel(),this.adjustSettingsForPerformance()}detectPerformanceLevel(){const t=this.canvas.width*this.canvas.height;return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||t>2073600?"low":t>921600?"medium":"high"}adjustSettingsForPerformance(){switch(this.performanceLevel){case"low":this.physics.fragmentCount=15,this.physics.crackPropagationSpeed=200,this.effects.refractionIntensity=.4;break;case"medium":this.physics.fragmentCount=20,this.physics.crackPropagationSpeed=250,this.effects.refractionIntensity=.6}}createShatterEffect(t,e,s=1){this.reset(),this.isShattered=!0,this.fadeAlpha=Math.min(1,.9*s),this.shatterTime=0;const i={x:t,y:e,intensity:s,radius:Math.min(100,50*s)};this.generateRealisticCracks(i),this.generateGlassFragments(i),this.createStressField(i),this.createAdvancedParticles(i)}generateRealisticCracks(t){const{x:e,y:s,intensity:i}=t;this.cracks=[];const a=Math.floor(6+8*i);for(let r=0;r<a;r++){const t=r/a*Math.PI*2+.5*(Math.random()-.5),n=this.createCrackLine(e,s,t,i,"primary");this.cracks.push(n)}const n=Math.floor(4+6*i);for(let r=0;r<n;r++){const t=Math.random()*Math.PI*2,a=50+80*Math.random(),n=e+Math.cos(t)*a,o=s+Math.sin(t)*a,r=this.createCrackLine(n,o,t+Math.PI/2,.7*i,"secondary");this.cracks.push(r)}const o=Math.floor(2+3*i);for(let r=0;r<o;r++){const t=30+25*r+20*Math.random(),a=this.createCircularCrack(e,s,t,i);this.cracks.push(a)}}createCrackLine(t,e,s,i,a){const n={points:[],type:a,width:"primary"===a?2+i:1+.5*i,opacity:.8,propagationSpeed:this.physics.crackPropagationSpeed,currentLength:0,targetLength:("primary"===a?150:80)+100*Math.random()*i},o=Math.floor(n.targetLength/10);let r=t,h=e,c=s;for(let l=0;l<=o;l++){const t=l/o,e=10+5*Math.random();if(c+=.3*(Math.random()-.5)*t,Math.random()<.1*i&&l>2){const t=c+(Math.random()-.5)*Math.PI/3,s=e*(.5+.5*Math.random()),i=r+Math.cos(t)*s,a=h+Math.sin(t)*s;n.points.push({x:i,y:a,isBranch:!0,opacity:.6})}if(r+=Math.cos(c)*e,h+=Math.sin(c)*e,r<0||r>this.canvas.width||h<0||h>this.canvas.height)break;n.points.push({x:r,y:h,isBranch:!1,opacity:.8*(1-.3*t)})}return n}createCircularCrack(t,e,s,i){const a={points:[],type:"circular",width:1+.5*i,opacity:.6,propagationSpeed:.7*this.physics.crackPropagationSpeed,currentLength:0,targetLength:s*Math.PI*2},n=Math.floor(.3*s);for(let o=0;o<n;o++){const i=o/n*Math.PI*2,r=15*(Math.random()-.5),h=t+Math.cos(i)*(s+r),c=e+Math.sin(i)*(s+r);a.points.push({x:h,y:c,isBranch:!1,opacity:.6})}return a}generateGlassFragments(t){this.fragments=[];const{x:e,y:s,intensity:i}=t;for(let a=0;a<this.physics.fragmentCount;a++){const t=Math.random()*Math.PI*2,a=80*Math.random()*i,n=3+8*Math.random(),o={x:e+Math.cos(t)*a,y:s+Math.sin(t)*a,vx:Math.cos(t)*(2+6*Math.random())*i,vy:Math.sin(t)*(2+6*Math.random())*i-2*Math.random(),size:n,rotation:Math.random()*Math.PI*2,rotationSpeed:.3*(Math.random()-.5),opacity:.7+.3*Math.random(),color:this.getGlassColor(),life:1,decay:3e-4+2e-4*Math.random()};this.fragments.push(o)}}createStressField(t){this.stressPoints=[];const{x:e,y:s,intensity:i,radius:a}=t,n=Math.floor(15+10*i);for(let o=0;o<n;o++){const t=Math.random()*Math.PI*2,n=Math.random()*a;this.stressPoints.push({x:e+Math.cos(t)*n,y:s+Math.sin(t)*n,intensity:i*(1-n/a),phase:Math.random()*Math.PI*2,radius:2+4*Math.random()})}}createAdvancedParticles(t){const{x:e,y:s,intensity:i}=t,a=Math.floor(40+80*i);for(let n=0;n<a;n++){const t=Math.random()*Math.PI*2,i=2+5*Math.random(),a=60*Math.random(),n=e+Math.cos(t)*a,o=s+Math.sin(t)*a,r=Math.cos(t)*i,h=Math.sin(t)*i+1*Math.random(),c=1+3*Math.random(),l=800+1500*Math.random(),d=this.getGlassParticleColor();this.particleManager.createParticle(n,o,d,c,r,h,l)}}getGlassColor(){const t=["rgba(255, 255, 255, 0.9)","rgba(240, 248, 255, 0.8)","rgba(220, 235, 255, 0.7)","rgba(200, 230, 255, 0.8)"];return t[Math.floor(Math.random()*t.length)]}getGlassParticleColor(){const t=["rgba(255, 255, 255, 0.9)","rgba(180, 220, 255, 0.7)","rgba(200, 240, 255, 0.8)","rgba(160, 200, 255, 0.6)"];return t[Math.floor(Math.random()*t.length)]}update(t){if(!this.isShattered)return;this.shatterTime+=t;const e=t/16,s=this.shatterTime/this.maxShatterTime;this.fadeAlpha=Math.max(0,.9*(1-s)),this.effects.shimmerPhase+=.1*e,this.updateCrackPropagation(e),this.updateFragments(e),this.updateStressField(e),this.shatterTime>=this.maxShatterTime&&this.reset()}updateCrackPropagation(t){this.cracks.forEach(e=>{e.currentLength<e.targetLength&&(e.currentLength+=e.propagationSpeed*t,e.currentLength=Math.min(e.currentLength,e.targetLength))})}updateFragments(t){this.fragments.forEach(e=>{e.x+=e.vx*t,e.y+=e.vy*t,e.vy+=this.physics.gravity*t,e.vx*=this.physics.friction,e.vy*=this.physics.friction,e.rotation+=e.rotationSpeed*t,e.life-=e.decay*t,e.opacity=Math.max(0,.8*e.life),(e.x<0||e.x>this.canvas.width)&&(e.vx*=-this.physics.elasticity),e.y>this.canvas.height&&(e.vy*=-this.physics.elasticity,e.y=this.canvas.height)}),this.fragments=this.fragments.filter(t=>t.life>0)}updateStressField(t){this.stressPoints.forEach(e=>{e.phase+=.15*t,e.intensity*=.995})}draw(){!this.isShattered||this.fadeAlpha<=0||(this.ctx.save(),this.drawStressField(),this.drawCracks(),this.drawFragments(),this.drawRefractionEffect(),this.ctx.restore())}drawStressField(){this.ctx.globalAlpha=.3*this.fadeAlpha,this.stressPoints.forEach(t=>{const e=t.intensity*(1+.3*Math.sin(t.phase)),s=t.radius*e,i=this.ctx.createRadialGradient(t.x,t.y,0,t.x,t.y,s);i.addColorStop(0,`rgba(255, 255, 255, ${.4*e})`),i.addColorStop(1,"rgba(255, 255, 255, 0)"),this.ctx.fillStyle=i,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,s,0,2*Math.PI),this.ctx.fill()})}drawCracks(){this.ctx.globalAlpha=this.fadeAlpha,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.cracks.forEach(t=>{if(t.points.length<2)return;const e=Math.min(t.currentLength,t.targetLength),s=Math.floor(e/t.targetLength*t.points.length);if(this.ctx.strokeStyle=`rgba(255, 255, 255, ${t.opacity})`,this.ctx.lineWidth=t.width,this.ctx.shadowColor="rgba(255, 255, 255, 0.8)",this.ctx.shadowBlur=2*t.width,this.ctx.beginPath(),s>0){this.ctx.moveTo(t.points[0].x,t.points[0].y);for(let e=1;e<s;e++){const s=t.points[e];this.ctx.globalAlpha=this.fadeAlpha*s.opacity,this.ctx.lineTo(s.x,s.y)}}this.ctx.stroke(),this.ctx.globalAlpha=.5*this.fadeAlpha*(1+.3*Math.sin(this.effects.shimmerPhase)),this.ctx.strokeStyle="rgba(180, 220, 255, 0.6)",this.ctx.lineWidth=.5*t.width,this.ctx.stroke()})}drawFragments(){this.fragments.forEach(t=>{this.ctx.save(),this.ctx.globalAlpha=t.opacity*this.fadeAlpha,this.ctx.translate(t.x,t.y),this.ctx.rotate(t.rotation),this.ctx.fillStyle=t.color,this.ctx.beginPath(),this.ctx.rect(-t.size/2,-t.size/2,t.size,t.size),this.ctx.fill(),this.ctx.globalAlpha=t.opacity*this.fadeAlpha*.8,this.ctx.fillStyle="rgba(255, 255, 255, 0.9)",this.ctx.beginPath(),this.ctx.rect(-t.size/2,-t.size/2,t.size/3,t.size/3),this.ctx.fill(),this.ctx.restore()})}drawRefractionEffect(){this.effects.refractionIntensity<=0||(this.ctx.globalAlpha=this.fadeAlpha*this.effects.refractionIntensity*.3,this.ctx.fillStyle="rgba(255, 255, 255, 0.1)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height))}reset(){this.isShattered=!1,this.shatterTime=0,this.fadeAlpha=0,this.cracks=[],this.fragments=[],this.stressPoints=[],this.effects.shimmerPhase=0}isActive(){return this.isShattered}triggerShatter(t,e,s=1){this.createShatterEffect(t,e,s)}}class f{constructor(){this.storageKey="superstudent_progress",this.levels=["colors","shapes","alphabet","numbers","clcase","phonics"],this.progress=this.loadProgress()}loadProgress(){try{const t=localStorage.getItem(this.storageKey);if(t)return JSON.parse(t)}catch(t){console.warn("Failed to load progress:",t)}return{unlockedLevels:["colors"],completedLevels:[],scores:{},totalScore:0}}saveProgress(){try{localStorage.setItem(this.storageKey,JSON.stringify(this.progress))}catch(t){console.warn("Failed to save progress:",t)}}isLevelUnlocked(t){return this.progress.unlockedLevels.includes(t)}isLevelCompleted(t){return this.progress.completedLevels.includes(t)}completeLevel(t,e=0){this.progress.completedLevels.includes(t)||this.progress.completedLevels.push(t),this.progress.scores[t]=Math.max(this.progress.scores[t]||0,e),this.progress.totalScore=Object.values(this.progress.scores).reduce((t,e)=>t+e,0);const s=this.levels.indexOf(t);if(s>=0&&s<this.levels.length-1){const t=this.levels[s+1];this.progress.unlockedLevels.includes(t)||this.progress.unlockedLevels.push(t)}this.saveProgress()}getLevelScore(t){return this.progress.scores[t]||0}getProgress(){return{...this.progress}}resetProgress(){this.progress={unlockedLevels:["colors"],completedLevels:[],scores:{},totalScore:0},this.saveProgress()}getCompletionPercentage(){return Math.round(this.progress.completedLevels.length/this.levels.length*100)}}class m{constructor(t,e,s,i){this.canvas=t,this.ctx=e,this.managers=s,this.helpers=i,this.running=!1,this.score=0}async init(){throw new Error("init() must be implemented by subclass")}update(t){throw new Error("update() must be implemented by subclass")}render(){throw new Error("render() must be implemented by subclass")}cleanup(){throw new Error("cleanup() must be implemented by subclass")}async start(){await this.init(),this.running=!0}end(){this.running=!1,this.cleanup(),this.helpers&&this.helpers.onLevelComplete&&this.helpers.onLevelComplete(this.score)}pause(){this.running=!1}resume(){this.running=!0}reset(){this.cleanup(),this.score=0,this.init()}updateScore(t){this.score=Math.max(0,this.score+t),this.managers&&this.managers.hud&&this.managers.hud.updateScore(t)}resize(t){this.canvas=t}}const b={colors:{totalDots:a.COLORS_LEVEL_CONFIG?.TOTAL_DOTS||85,targetDots:a.COLORS_LEVEL_CONFIG?.TARGET_DOTS||17,distractorDots:a.COLORS_LEVEL_CONFIG?.DISTRACTOR_DOTS||68,dispersionFrames:a.COLORS_LEVEL_CONFIG?.DISPERSION_FRAMES||30,bounceDampening:a.COLORS_LEVEL_CONFIG?.DOT_BOUNCE_DAMPENING||.98,shimmerFreq:a.COLORS_LEVEL_CONFIG?.SHIMMER_FREQUENCY||.05,glowFreq:a.COLORS_LEVEL_CONFIG?.GLOW_FREQUENCY||.1,memoryTime:a.COLORS_LEVEL_CONFIG?.MEMORY_DISPLAY_TIME||2e3,collisionDelay:a.COLORS_LEVEL_CONFIG?.COLLISION_ENABLED_DELAY||250},text:{centerFontSize:a.TEXT_LEVEL_CONFIG?.CENTER_FONT_SIZE||900,fallingFontSize:a.TEXT_LEVEL_CONFIG?.FALLING_FONT_SIZE||240,spawnEdgeBuffer:a.TEXT_LEVEL_CONFIG?.SPAWN_EDGE_BUFFER||50,advanceCount:a.TEXT_LEVEL_CONFIG?.TARGET_ADVANCE_COUNT||5,checkpointInterval:a.TEXT_LEVEL_CONFIG?.CHECKPOINT_INTERVAL||5,abilities:a.TEXT_LEVEL_CONFIG?.ABILITIES||["laser","aoe","charge_up"],aoeRadius:a.TEXT_LEVEL_CONFIG?.AOE_RADIUS||200,chargeDuration:a.TEXT_LEVEL_CONFIG?.CHARGE_UP_DURATION||60,laserWidth:a.TEXT_LEVEL_CONFIG?.LASER_WIDTH||[3,5],swirlCount:a.TEXT_LEVEL_CONFIG?.SWIRL_PARTICLE_COUNT||30,orbitRadius:a.TEXT_LEVEL_CONFIG?.CENTER_PIECE_ORBIT_RADIUS||100}};class v extends m{constructor(t,e,s,i){super(t,e,s,i),this.memoryTime=b.colors.memoryTime,this.dots=[],this.state="memory",this.targetDotsRemaining=0,this.onPointerDown=this.onPointerDown.bind(this),this.correctStreak=0,this.lastCorrectTime=0,this.levelStartTime=0}async init(){const t=a.COLORS.COLORS_LIST;this.targetColor=t[0];const e=this.targetColor.join(",");this.mother={x:this.canvas.width/2,y:this.canvas.height/2,radius:this.managers?.displaySettings?.motherRadius||a.DOT_RADIUS,color:`rgb(${e})`},this.managers.sound&&(this.managers.sound.playSuccess(),await this.managers.sound.resumeContext()),this.canvas.addEventListener("pointerdown",this.onPointerDown),this.levelStartTime=performance.now(),setTimeout(()=>this.disperse(),this.memoryTime)}disperse(){this.state="playing";const t=b.colors,e=t.totalDots,s=t.targetDots;this.targetDotsRemaining=s;const i=a.COLORS.COLORS_LIST.filter(t=>t!==this.targetColor);for(let a=0;a<s;a++)this.addDot(this.targetColor,!0);for(let a=0;a<e-s;a++){const t=i[Math.floor(Math.random()*i.length)];this.addDot(t,!1)}this.managers.sound&&this.managers.sound.playPop(.8)}addDot(t,e){const s=Math.random()*Math.PI*2,i=Math.random()*(a.DOT_SPEED_RANGE[1]-a.DOT_SPEED_RANGE[0])+a.DOT_SPEED_RANGE[0],n={x:this.mother.x,y:this.mother.y,radius:a.DOT_RADIUS,color:`rgb(${t.join(",")})`,dx:Math.cos(s)*i,dy:Math.sin(s)*i,isTarget:e,shimmer:Math.random()*Math.PI*2,pulsePhase:Math.random()*Math.PI*2,trail:[]};this.dots.push(n)}update(t){if("playing"!==this.state)return;const e=t/16;this.dots.forEach(t=>{t.x+=t.dx*e,t.y+=t.dy*e,t.shimmer+=.1*e,t.pulsePhase+=.05*e,t.isTarget&&(t.trail.push({x:t.x,y:t.y,alpha:1}),t.trail.length>10&&t.trail.shift(),t.trail.forEach((e,s)=>{e.alpha=(s+1)/t.trail.length*.5})),(t.x-t.radius<0||t.x+t.radius>this.canvas.width)&&(t.dx*=-1,this.managers.sound&&Math.random()<.1&&this.managers.sound.playPop(.3)),(t.y-t.radius<0||t.y+t.radius>this.canvas.height)&&(t.dy*=-1,this.managers.sound&&Math.random()<.1&&this.managers.sound.playPop(.3))})}render(){"memory"===this.state?(this.drawEnhancedDot(this.mother,!0,!0),this.ctx.fillStyle="rgba(0, 0, 0, 0.8)",this.ctx.font="bold 24px Arial",this.ctx.textAlign="center",this.ctx.fillText("Remember this color!",this.canvas.width/2,50)):"playing"===this.state&&(this.dots.forEach(t=>{this.drawEnhancedDot(t,t.isTarget)}),this.drawUI())}drawEnhancedDot(t,e=!1,s=!1){if(this.ctx.save(),e&&t.trail&&t.trail.forEach(e=>{this.ctx.globalAlpha=e.alpha,this.ctx.fillStyle=t.color,this.ctx.beginPath(),this.ctx.arc(e.x,e.y,.5*t.radius,0,2*Math.PI),this.ctx.fill()}),this.ctx.globalAlpha=1,e||s){const e=.5+.3*Math.sin(t.pulsePhase||0);this.ctx.shadowColor=t.color,this.ctx.shadowBlur=20*e}const i=5*Math.sin(t.shimmer||0);this.ctx.fillStyle=t.color,this.ctx.beginPath(),this.ctx.arc(t.x+i,t.y,t.radius,0,2*Math.PI),this.ctx.fill(),(e||s)&&(this.ctx.globalAlpha=.8,this.ctx.fillStyle="rgba(255, 255, 255, 0.3)",this.ctx.beginPath(),this.ctx.arc(t.x+i-.3*t.radius,t.y-.3*t.radius,.4*t.radius,0,2*Math.PI),this.ctx.fill()),this.ctx.restore()}drawUI(){this.ctx.fillStyle="rgba(0, 0, 0, 0.8)",this.ctx.font="bold 18px Arial",this.ctx.textAlign="left",this.ctx.fillText(`Target Dots Remaining: ${this.targetDotsRemaining}`,20,30),this.correctStreak>0&&(this.ctx.fillStyle="#2ecc71",this.ctx.fillText(`Streak: ${this.correctStreak}`,20,55));const t=performance.now()-this.levelStartTime,e=Math.floor(t/1e3);this.ctx.fillStyle="rgba(0, 0, 0, 0.8)",this.ctx.textAlign="right",this.ctx.fillText(`Time: ${e}s`,this.canvas.width-20,30)}onPointerDown(t){if("playing"!==this.state)return;const e=this.canvas.getBoundingClientRect(),s=(t.clientX-e.left)*(this.canvas.width/e.width),i=(t.clientY-e.top)*(this.canvas.height/e.height);for(let a=this.dots.length-1;a>=0;a--){const t=this.dots[a],e=s-t.x,n=i-t.y;if(Math.sqrt(e*e+n*n)<=t.radius){t.isTarget?this.handleCorrectHit(t,a):this.handleWrongHit(t,a);break}}}handleCorrectHit(t,e){this.correctStreak++,this.lastCorrectTime=performance.now(),this.helpers.createExplosion(t.x,t.y,t.color,1.5),this.managers.sound&&(this.managers.sound.playSuccess(),setTimeout(()=>{this.managers.sound.playPop(1.2)},100));const s=100+20*Math.min(this.correctStreak,5);this.updateScore(s),this.targetDotsRemaining--,this.dots.splice(e,1),this.correctStreak>=3&&this.managers.particleManager.createSparkle(t.x,t.y,"#ffd700",1.5),this.targetDotsRemaining<=0&&this.completeLevel()}handleWrongHit(t,e){this.correctStreak=0,this.helpers.applyExplosionEffect(t.x,t.y,30,1),this.managers.sound&&this.managers.sound.playWrong(),this.updateScore(-50),this.dots.splice(e,1),this.managers.centerPiece}completeLevel(){this.managers.sound&&this.managers.sound.playSequence([{type:"sound",name:"success",volume:1},{type:"sound",name:"pop",volume:.8,pitch:1.2}],300);const t=this.canvas.width/2,e=this.canvas.height/2;for(let a=0;a<3;a++)setTimeout(()=>{this.managers.particleManager.createExplosion(t+200*(Math.random()-.5),e+200*(Math.random()-.5),this.mother.color,2,30)},500*a);const s=Math.max(0,1e4-(performance.now()-this.levelStartTime))/100,i=50*this.correctStreak;this.updateScore(Math.floor(s+i)),setTimeout(()=>{this.end()},3e3)}cleanup(){this.canvas.removeEventListener("pointerdown",this.onPointerDown),this.dots=[]}}class y extends m{constructor(t,e,s,i){super(t,e,s,i),this.sequence=a.SEQUENCES.shapes,this.objects=[],this.currentIndex=0,this.groupCount=0,this.spawnTimer=0,this.spawnInterval=a.LETTER_SPAWN_INTERVAL,this.onPointerDown=this.onPointerDown.bind(this)}async init(){this.currentTarget=this.sequence[this.currentIndex],this.objects=[],this.groupCount=0,this.spawnTimer=0,this.canvas.addEventListener("pointerdown",this.onPointerDown),this.running=!0}update(t){if(!this.running)return;this.spawnTimer+=t,this.spawnTimer>=this.spawnInterval&&(this.spawnTimer=0,this.spawnObject());const e=t/16;this.objects.forEach(t=>{t.x+=t.dx*e,t.y+=t.dy*e}),this.objects=this.objects.filter(t=>t.x>-50&&t.x<this.canvas.width+50&&t.y>-50&&t.y<this.canvas.height+50)}render(){const t=b.text.centerFontSize;this.ctx.save(),this.ctx.translate(this.canvas.width/2,this.canvas.height/2),this.ctx.fillStyle="#FFFFFF",this.drawShape(this.currentTarget,t),this.ctx.restore(),this.objects.forEach(t=>{this.ctx.save(),this.ctx.translate(t.x,t.y),this.ctx.fillStyle=t.color,this.drawShape(t.shape,b.text.fallingFontSize),this.ctx.restore()})}spawnObject(){const t=b.text.spawnEdgeBuffer,e=Math.floor(4*Math.random());let s,i,n,o;const r=2*Math.random()+1;switch(e){case 0:s=Math.random()*this.canvas.width,i=-t,n=2*(Math.random()-.5),o=r;break;case 1:s=Math.random()*this.canvas.width,i=this.canvas.height+t,n=2*(Math.random()-.5),o=-r;break;case 2:s=-t,i=Math.random()*this.canvas.height,n=r,o=2*(Math.random()-.5);break;default:s=this.canvas.width+t,i=Math.random()*this.canvas.height,n=-r,o=2*(Math.random()-.5)}const h=["Circle","Square","Triangle","Rectangle","Pentagon"],c=h[Math.floor(Math.random()*h.length)],l=`rgb(${a.COLORS.COLORS_LIST[Math.floor(Math.random()*a.COLORS.COLORS_LIST.length)].join(",")})`;this.objects.push({shape:c,x:s,y:i,dx:n,dy:o,color:l})}onPointerDown(t){if(!this.running)return;const e=this.canvas.getBoundingClientRect(),s=(t.clientX-e.left)*(this.canvas.width/e.width),i=(t.clientY-e.top)*(this.canvas.height/e.height);let a=!1;this.objects=this.objects.filter(t=>{const e=b.text.fallingFontSize,n=s-t.x,o=i-t.y,r=e/2;return!(n*n+o*o<=r*r)||(t.shape===this.currentTarget?(this.helpers.createExplosion(t.x,t.y,t.color,1),this.managers.hud.updateScore(10),this.groupCount++,a=!0):(this.helpers.applyExplosionEffect(t.x,t.y,r,1),this.managers.hud.updateScore(-5)),!1)}),a&&this.groupCount>=b.text.advanceCount&&(this.currentIndex++,this.currentIndex>=this.sequence.length?this.end():(this.currentTarget=this.sequence[this.currentIndex],this.groupCount=0))}drawShape(t,e){const s=e/2;switch(this.ctx.beginPath(),t){case"Circle":default:this.ctx.arc(0,0,s,0,2*Math.PI);break;case"Square":this.ctx.rect(-s,-s,e,e);break;case"Triangle":this.ctx.moveTo(0,-s),this.ctx.lineTo(s,s),this.ctx.lineTo(-s,s),this.ctx.closePath();break;case"Rectangle":this.ctx.rect(-s,.6*-s,e,.6*e);break;case"Pentagon":for(let t=0;t<5;t++){const e=2*Math.PI/5*t-Math.PI/2,i=Math.cos(e)*s,a=Math.sin(e)*s;0===t?this.ctx.moveTo(i,a):this.ctx.lineTo(i,a)}this.ctx.closePath()}this.ctx.fill()}cleanup(){this.canvas.removeEventListener("pointerdown",this.onPointerDown),this.objects=[]}}class x extends m{constructor(t,e,s,i){super(t,e,s,i),this.sequence=a.SEQUENCES.alphabet,this.objects=[],this.currentIndex=0,this.groupCount=0,this.spawnTimer=0,this.spawnInterval=a.LETTER_SPAWN_INTERVAL,this.onPointerDown=this.onPointerDown.bind(this)}async init(){this.currentTarget=this.sequence[this.currentIndex],this.objects=[],this.groupCount=0,this.spawnTimer=0,this.canvas.addEventListener("pointerdown",this.onPointerDown),this.running=!0}update(t){if(!this.running)return;this.spawnTimer+=t,this.spawnTimer>=this.spawnInterval&&(this.spawnTimer=0,this.spawnObject());const e=t/16;this.objects.forEach(t=>{t.x+=t.dx*e,t.y+=t.dy*e}),this.objects=this.objects.filter(t=>t.x>-50&&t.x<this.canvas.width+50&&t.y>-50&&t.y<this.canvas.height+50)}render(){this.ctx.save(),this.ctx.fillStyle="#FFFFFF",this.ctx.textAlign="center",this.ctx.font=`${b.text.centerFontSize}px Arial`,this.ctx.fillText(this.currentTarget,this.canvas.width/2,this.canvas.height/2),this.ctx.restore(),this.objects.forEach(t=>{this.ctx.save(),this.ctx.fillStyle=t.color,this.ctx.textAlign="center",this.ctx.font=`${b.text.fallingFontSize}px Arial`,this.ctx.fillText(t.char,t.x,t.y),this.ctx.restore()})}spawnObject(){const t=b.text.spawnEdgeBuffer,e=Math.floor(4*Math.random());let s,i,n,o;const r=2*Math.random()+1;switch(e){case 0:s=Math.random()*this.canvas.width,i=-t,n=2*(Math.random()-.5),o=r;break;case 1:s=Math.random()*this.canvas.width,i=this.canvas.height+t,n=2*(Math.random()-.5),o=-r;break;case 2:s=-t,i=Math.random()*this.canvas.height,n=r,o=2*(Math.random()-.5);break;case 3:s=this.canvas.width+t,i=Math.random()*this.canvas.height,n=-r,o=2*(Math.random()-.5)}const h=`rgb(${a.COLORS.COLORS_LIST[Math.floor(Math.random()*a.COLORS.COLORS_LIST.length)].join(",")})`;this.objects.push({char:this.currentTarget,x:s,y:i,dx:n,dy:o,color:h})}onPointerDown(t){if(!this.running)return;const e=this.canvas.getBoundingClientRect(),s=(t.clientX-e.left)*(this.canvas.width/e.width),i=(t.clientY-e.top)*(this.canvas.height/e.height);let a=!1;this.objects=this.objects.filter(t=>{const e=b.text.fallingFontSize,n=b.text.fallingFontSize;return!(s>t.x-e/2&&s<t.x+e/2&&i>t.y-n&&i<t.y)||(t.char===this.currentTarget?(this.helpers.createExplosion(t.x,t.y,t.color,1),this.updateScore(100),this.groupCount++,a=!0):(this.helpers.applyExplosionEffect(t.x,t.y,20,1),this.updateScore(-25)),!1)}),a&&this.groupCount>=b.text.advanceCount&&(this.currentIndex++,this.currentIndex>=this.sequence.length?this.end():(this.currentTarget=this.sequence[this.currentIndex],this.groupCount=0))}cleanup(){this.canvas.removeEventListener("pointerdown",this.onPointerDown),this.objects=[]}}class w extends m{constructor(t,e,s,i){super(t,e,s,i),this.sequence=a.SEQUENCES.numbers,this.objects=[],this.currentIndex=0,this.groupCount=0,this.spawnTimer=0,this.spawnInterval=a.LETTER_SPAWN_INTERVAL,this.onPointerDown=this.onPointerDown.bind(this)}async init(){this.currentTarget=this.sequence[this.currentIndex],this.objects=[],this.groupCount=0,this.spawnTimer=0,this.canvas.addEventListener("pointerdown",this.onPointerDown),this.running=!0}update(t){if(!this.running)return;this.spawnTimer+=t,this.spawnTimer>=this.spawnInterval&&(this.spawnTimer=0,this.spawnObject());const e=t/16;this.objects.forEach(t=>{t.x+=t.dx*e,t.y+=t.dy*e}),this.objects=this.objects.filter(t=>t.x>-50&&t.x<this.canvas.width+50&&t.y>-50&&t.y<this.canvas.height+50)}render(){this.ctx.save(),this.ctx.fillStyle="#FFFFFF",this.ctx.textAlign="center",this.ctx.font=`${b.text.centerFontSize}px Arial`,this.ctx.fillText(this.currentTarget,this.canvas.width/2,this.canvas.height/2),this.ctx.restore(),this.objects.forEach(t=>{this.ctx.save(),this.ctx.fillStyle=t.color,this.ctx.textAlign="center",this.ctx.font=`${b.text.fallingFontSize}px Arial`,this.ctx.fillText(t.char,t.x,t.y),this.ctx.restore()})}spawnObject(){const t=b.text.spawnEdgeBuffer,e=Math.floor(4*Math.random());let s,i,n,o;const r=2*Math.random()+1;switch(e){case 0:s=Math.random()*this.canvas.width,i=-t,n=2*(Math.random()-.5),o=r;break;case 1:s=Math.random()*this.canvas.width,i=this.canvas.height+t,n=2*(Math.random()-.5),o=-r;break;case 2:s=-t,i=Math.random()*this.canvas.height,n=r,o=2*(Math.random()-.5);break;case 3:s=this.canvas.width+t,i=Math.random()*this.canvas.height,n=-r,o=2*(Math.random()-.5)}const h=["1","2","3","4","5","6","7","8","9","10"],c=h[Math.floor(Math.random()*h.length)],l=`rgb(${a.COLORS.COLORS_LIST[Math.floor(Math.random()*a.COLORS.COLORS_LIST.length)].join(",")})`;this.objects.push({char:c,x:s,y:i,dx:n,dy:o,color:l})}onPointerDown(t){if(!this.running)return;const e=this.canvas.getBoundingClientRect(),s=(t.clientX-e.left)*(this.canvas.width/e.width),i=(t.clientY-e.top)*(this.canvas.height/e.height);let a=!1;this.objects=this.objects.filter(t=>{const e=b.text.fallingFontSize,n=b.text.fallingFontSize;return!(s>t.x-e/2&&s<t.x+e/2&&i>t.y-n&&i<t.y)||(t.char===this.currentTarget?(this.helpers.createExplosion(t.x,t.y,t.color,1),this.updateScore(100),this.groupCount++,a=!0):(this.helpers.applyExplosionEffect(t.x,t.y,20,1),this.updateScore(-25)),!1)}),a&&this.groupCount>=b.text.advanceCount&&(this.currentIndex++,this.currentIndex>=this.sequence.length?this.end():(this.currentTarget=this.sequence[this.currentIndex],this.groupCount=0))}cleanup(){this.canvas.removeEventListener("pointerdown",this.onPointerDown),this.objects=[]}}class S extends m{constructor(t,e,s,i){super(t,e,s,i),this.sequence=a.SEQUENCES.clcase,this.objects=[],this.currentIndex=0,this.groupCount=0,this.spawnTimer=0,this.spawnInterval=a.LETTER_SPAWN_INTERVAL,this.onPointerDown=this.onPointerDown.bind(this)}async init(){this.currentTarget=this.sequence[this.currentIndex],this.objects=[],this.groupCount=0,this.spawnTimer=0,this.canvas.addEventListener("pointerdown",this.onPointerDown),this.running=!0}update(t){if(!this.running)return;this.spawnTimer+=t,this.spawnTimer>=this.spawnInterval&&(this.spawnTimer=0,this.spawnObject());const e=t/16;this.objects.forEach(t=>{t.x+=t.dx*e,t.y+=t.dy*e}),this.objects=this.objects.filter(t=>t.x>-50&&t.x<this.canvas.width+50&&t.y>-50&&t.y<this.canvas.height+50)}render(){this.ctx.save(),this.ctx.fillStyle="#FFFFFF",this.ctx.textAlign="center",this.ctx.font=`${b.text.centerFontSize}px Arial`,this.ctx.fillText(this.currentTarget,this.canvas.width/2,this.canvas.height/2),this.ctx.restore(),this.objects.forEach(t=>{this.ctx.save(),this.ctx.fillStyle=t.color,this.ctx.textAlign="center",this.ctx.font=`${b.text.fallingFontSize}px Arial`,this.ctx.fillText(t.char,t.x,t.y),this.ctx.restore()})}spawnObject(){const t=b.text.spawnEdgeBuffer,e=Math.floor(4*Math.random());let s,i,n,o;const r=2*Math.random()+1;switch(e){case 0:s=Math.random()*this.canvas.width,i=-t,n=2*(Math.random()-.5),o=r;break;case 1:s=Math.random()*this.canvas.width,i=this.canvas.height+t,n=2*(Math.random()-.5),o=-r;break;case 2:s=-t,i=Math.random()*this.canvas.height,n=r,o=2*(Math.random()-.5);break;case 3:s=this.canvas.width+t,i=Math.random()*this.canvas.height,n=-r,o=2*(Math.random()-.5)}const h="abcdefghijklmnopqrstuvwxyz".split(""),c=h[Math.floor(Math.random()*h.length)],l=`rgb(${a.COLORS.COLORS_LIST[Math.floor(Math.random()*a.COLORS.COLORS_LIST.length)].join(",")})`;this.objects.push({char:c,x:s,y:i,dx:n,dy:o,color:l})}onPointerDown(t){if(!this.running)return;const e=this.canvas.getBoundingClientRect(),s=(t.clientX-e.left)*(this.canvas.width/e.width),i=(t.clientY-e.top)*(this.canvas.height/e.height);let a=!1;this.objects=this.objects.filter(t=>{const e=b.text.fallingFontSize,n=b.text.fallingFontSize;return!(s>t.x-e/2&&s<t.x+e/2&&i>t.y-n&&i<t.y)||(t.char===this.currentTarget?(this.helpers.createExplosion(t.x,t.y,t.color,1),this.updateScore(100),this.groupCount++,a=!0):(this.helpers.applyExplosionEffect(t.x,t.y,20,1),this.updateScore(-25)),!1)}),a&&this.groupCount>=b.text.advanceCount&&(this.currentIndex++,this.currentIndex>=this.sequence.length?this.end():(this.currentTarget=this.sequence[this.currentIndex],this.groupCount=0))}cleanup(){this.canvas.removeEventListener("pointerdown",this.onPointerDown),this.objects=[]}}const M={performance:{maxBubbles:12,maxParticles:100,targetFPS:60,bubblePoolSize:20,particlePoolSize:50},physics:{gravity:.1,buoyancy:.15,drag:.98,pop:{minForce:.5,maxForce:2,particleCount:8},bounce:{damping:.7,elasticity:.3}},visuals:{bubbleSize:{min:40,max:80},colors:{bubbleBase:"rgba(173, 216, 230, 0.8)",bubbleHighlight:"rgba(255, 255, 255, 0.9)",bubbleShadow:"rgba(0, 0, 0, 0.1)",letterColor:"#2c3e50",correctGlow:"#2ecc71",wrongGlow:"#e74c3c",background:"#f8f9fa"},effects:{shimmer:{enabled:!0,intensity:.3,speed:.1},floating:{enabled:!0,amplitude:2,frequency:.05},glow:{enabled:!0,radius:20,intensity:.5}}},education:{alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),phonicsMap:{A:{sound:"ay",frequency:[800,1200]},B:{sound:"buh",frequency:[100,200]},C:{sound:"kuh",frequency:[200,300]},D:{sound:"duh",frequency:[150,250]},E:{sound:"ee",frequency:[500,700]},F:{sound:"fuh",frequency:[300,400]},G:{sound:"guh",frequency:[120,220]},H:{sound:"huh",frequency:[100,150]},I:{sound:"eye",frequency:[300,500]},J:{sound:"juh",frequency:[200,400]},K:{sound:"kuh",frequency:[250,350]},L:{sound:"luh",frequency:[400,600]},M:{sound:"muh",frequency:[150,300]},N:{sound:"nuh",frequency:[200,400]},O:{sound:"oh",frequency:[400,600]},P:{sound:"puh",frequency:[100,200]},Q:{sound:"kwuh",frequency:[250,450]},R:{sound:"ruh",frequency:[300,500]},S:{sound:"sss",frequency:[500,800]},T:{sound:"tuh",frequency:[400,600]},U:{sound:"ooo",frequency:[300,500]},V:{sound:"vuh",frequency:[200,400]},W:{sound:"wuh",frequency:[250,450]},X:{sound:"ks",frequency:[300,600]},Y:{sound:"yuh",frequency:[400,700]},Z:{sound:"zuh",frequency:[400,800]}},difficulty:{easy:{letters:["A","B","C","D","E"],spawnRate:2e3,bubbleSpeed:.5,targetCount:3},medium:{letters:["F","G","H","I","J","K","L","M","N","O"],spawnRate:1500,bubbleSpeed:.7,targetCount:5},hard:{letters:["P","Q","R","S","T","U","V","W","X","Y","Z"],spawnRate:1200,bubbleSpeed:.9,targetCount:7}},progression:{levelDuration:6e4,correctScorePoints:100,wrongScorePenalty:-25,streakMultiplier:1.5,maxStreak:5}},gameplay:{spawnZone:{x:.1,y:.9,width:.8,height:.1},targetZone:{x:.2,y:.1,width:.6,height:.3},bubbleLifetime:15e3,comboWindow:3e3,pauseOnWrong:500,celebrationDuration:2e3},audio:{phonics:{volume:.8,pitch:1,playOnSpawn:!0,playOnPop:!0,repeatDelay:1e3},effects:{bubblePop:{volume:.6,pitch:1},correct:{volume:.7,pitch:1},wrong:{volume:.5,pitch:.8},levelComplete:{volume:.8,pitch:1},combo:{volume:.6,pitch:1.2}}}};class P{constructor(t,s,i,a){e(this,"onCorrectAnswer",null),e(this,"onWrongAnswer",null),this.canvas=t,this.ctx=s,this.particleManager=i,this.soundManager=a,this.config=M,this.bubbles=[],this.bubblePool=[],this.activeBubbles=0,this.lastSpawnTime=0,this.spawnRate=this.config.education.difficulty.easy.spawnRate,this.maxBubbles=this.config.performance.maxBubbles,this.time=0,this.shimmerPhase=0,this.initializeBubblePool(),this.targetLetter=null,this.targetLetterIndex=0,this.currentDifficulty="easy",this.streak=0,this.combo=0,this.lastCorrectTime=0,this.onPointerDown=this.onPointerDown.bind(this),this.setupEventListeners()}initializeBubblePool(){for(let t=0;t<this.config.performance.bubblePoolSize;t++)this.bubblePool.push(this.createBubbleObject())}createBubbleObject(){return{x:0,y:0,vx:0,vy:0,size:0,letter:"",isTarget:!1,lifetime:0,maxLifetime:0,phase:Math.random()*Math.PI*2,popAnimation:0,isPopping:!1,glowIntensity:0,shimmerOffset:Math.random()*Math.PI*2,active:!1,age:0,bounceCount:0,lastSoundTime:0}}setupEventListeners(){this.canvas.addEventListener("pointerdown",this.onPointerDown),this.canvas.addEventListener("touchstart",this.onPointerDown)}removeEventListeners(){this.canvas.removeEventListener("pointerdown",this.onPointerDown),this.canvas.removeEventListener("touchstart",this.onPointerDown)}setDifficulty(t){this.currentDifficulty=t,this.spawnRate=this.config.education.difficulty[t].spawnRate,this.maxBubbles=Math.floor(this.config.performance.maxBubbles*("easy"===t?.7:"medium"===t?.85:1))}setTargetLetter(t){this.targetLetter=t,this.targetLetterIndex=this.config.education.alphabet.indexOf(t)}getNextTargetLetter(){const t=this.config.education.difficulty[this.currentDifficulty].letters;return this.targetLetterIndex=(this.targetLetterIndex+1)%t.length,t[this.targetLetterIndex]}spawnBubble(t=null,e=!1){if(this.activeBubbles>=this.maxBubbles)return null;let s=this.bubblePool.find(t=>!t.active);s||(s=this.createBubbleObject(),this.bubblePool.push(s));const i=this.config.gameplay.spawnZone,a=this.config.visuals.bubbleSize.min+Math.random()*(this.config.visuals.bubbleSize.max-this.config.visuals.bubbleSize.min);return s.x=(i.x+Math.random()*i.width)*this.canvas.width,s.y=i.y*this.canvas.height,s.vx=.5*(Math.random()-.5),s.vy=-this.config.education.difficulty[this.currentDifficulty].bubbleSpeed,s.size=a,s.letter=t||this.getRandomLetter(),s.isTarget=e,s.lifetime=0,s.maxLifetime=this.config.gameplay.bubbleLifetime,s.phase=Math.random()*Math.PI*2,s.popAnimation=0,s.isPopping=!1,s.glowIntensity=e?.5:0,s.shimmerOffset=Math.random()*Math.PI*2,s.active=!0,s.age=0,s.bounceCount=0,s.lastSoundTime=0,this.bubbles.push(s),this.activeBubbles++,this.config.audio.phonics.playOnSpawn&&this.soundManager.playPhonicsSound(s.letter,this.config.audio.phonics.volume),s}getRandomLetter(){const t=this.config.education.difficulty[this.currentDifficulty].letters;return t[Math.floor(Math.random()*t.length)]}update(t){this.time+=t,this.shimmerPhase+=this.config.visuals.effects.shimmer.speed*t/16,this.updateSpawning(t),this.updateBubbles(t),this.cleanupBubbles(),this.updateCombo(t)}updateSpawning(t){const e=performance.now();if(e-this.lastSpawnTime>=this.spawnRate){this.targetLetter&&Math.random()<.4&&!this.bubbles.some(t=>t.isTarget)?this.spawnBubble(this.targetLetter,!0):this.spawnBubble(),this.lastSpawnTime=e}}updateBubbles(t){const e=t/16;this.bubbles.forEach(s=>{if(s.active){if(s.lifetime+=t,s.age+=t,s.isPopping)return s.popAnimation+=t/200,void(s.popAnimation>=1&&this.deactivateBubble(s));this.updateBubblePhysics(s,e),this.updateBubbleEffects(s,e),this.checkBoundaries(s),s.lifetime>=s.maxLifetime&&this.popBubble(s,!1)}})}updateBubblePhysics(t,e){if(t.vy-=this.config.physics.buoyancy*e,t.vy+=this.config.physics.gravity*e,t.vx*=this.config.physics.drag,t.vy*=this.config.physics.drag,this.config.visuals.effects.floating.enabled){const e=Math.sin(this.time*this.config.visuals.effects.floating.frequency+t.phase)*this.config.visuals.effects.floating.amplitude;t.vx+=.01*e}t.x+=t.vx*e,t.y+=t.vy*e}updateBubbleEffects(t,e){t.phase+=.02*e,t.isTarget&&(t.glowIntensity=.5+.3*Math.sin(.005*this.time)),t.shimmerOffset+=this.config.visuals.effects.shimmer.speed*e}checkBoundaries(t){const e=t.size/2;t.x-e<0?(t.x=e,t.vx=-t.vx*this.config.physics.bounce.elasticity,t.bounceCount++):t.x+e>this.canvas.width&&(t.x=this.canvas.width-e,t.vx=-t.vx*this.config.physics.bounce.elasticity,t.bounceCount++),t.y+e<0&&this.deactivateBubble(t),t.y+e>this.canvas.height&&(t.y=this.canvas.height-e,t.vy=-t.vy*this.config.physics.bounce.elasticity,t.bounceCount++),t.bounceCount>0&&(t.vx*=this.config.physics.bounce.damping,t.vy*=this.config.physics.bounce.damping)}cleanupBubbles(){this.bubbles=this.bubbles.filter(t=>t.active),this.activeBubbles=this.bubbles.length}updateCombo(t){performance.now()-this.lastCorrectTime>this.config.gameplay.comboWindow&&(this.combo=0)}onPointerDown(t){t.preventDefault();const e=this.canvas.getBoundingClientRect(),s=(t.clientX-e.left)*(this.canvas.width/e.width),i=(t.clientY-e.top)*(this.canvas.height/e.height),a=this.findBubbleAtPoint(s,i);a&&this.handleBubbleClick(a)}findBubbleAtPoint(t,e){for(let s=this.bubbles.length-1;s>=0;s--){const i=this.bubbles[s];if(!i.active||i.isPopping)continue;const a=t-i.x,n=e-i.y;if(Math.sqrt(a*a+n*n)<=i.size/2)return i}return null}handleBubbleClick(t){const e=t.letter===this.targetLetter;e?this.handleCorrectAnswer(t):this.handleWrongAnswer(t),this.popBubble(t,e)}handleCorrectAnswer(t){this.streak++,this.combo++,this.lastCorrectTime=performance.now();const e=this.config.education.progression.correctScorePoints,s=Math.min(this.streak,this.config.education.progression.maxStreak)*this.config.education.progression.streakMultiplier,i=.5*Math.min(this.combo,3),a=Math.floor(e*(1+s+i));this.soundManager.playSuccess(),this.config.audio.phonics.playOnPop&&this.soundManager.playPhonicsSound(t.letter,this.config.audio.phonics.volume),this.createSuccessEffect(t),this.onCorrectAnswer&&this.onCorrectAnswer(t.letter,a)}handleWrongAnswer(t){this.streak=0,this.soundManager.playWrong(),this.createWrongEffect(t),this.onWrongAnswer&&this.onWrongAnswer(t.letter,this.config.education.progression.wrongScorePenalty)}popBubble(t,e){t.isPopping||(t.isPopping=!0,t.popAnimation=0,this.soundManager.playPop(1),this.createPopParticles(t,e),this.activeBubbles--)}createSuccessEffect(t){const e=this.config.physics.pop.particleCount;for(let s=0;s<e;s++){const i=s/e*Math.PI*2,a=2+3*Math.random(),n=Math.cos(i)*a,o=Math.sin(i)*a,r=2+3*Math.random(),h=800+400*Math.random();this.particleManager.createParticle(t.x,t.y,this.config.visuals.colors.correctGlow,r,n,o,h)}}createWrongEffect(t){const e=this.config.physics.pop.particleCount;for(let s=0;s<e;s++){const i=s/e*Math.PI*2,a=1+2*Math.random(),n=Math.cos(i)*a,o=Math.sin(i)*a,r=1+2*Math.random(),h=600+300*Math.random();this.particleManager.createParticle(t.x,t.y,this.config.visuals.colors.wrongGlow,r,n,o,h)}}createPopParticles(t,e){const s=this.config.physics.pop.particleCount,i=e?this.config.visuals.colors.correctGlow:this.config.visuals.colors.bubbleBase;for(let a=0;a<s;a++){const e=a/s*Math.PI*2,n=1+2*Math.random(),o=Math.cos(e)*n,r=Math.sin(e)*n,h=1+2*Math.random(),c=500+500*Math.random();this.particleManager.createParticle(t.x,t.y,i,h,o,r,c)}}deactivateBubble(t){t.active=!1,t.isPopping=!1,t.popAnimation=0,t.glowIntensity=0,t.lifetime=0,t.age=0,t.bounceCount=0}draw(t){this.bubbles.forEach(e=>{e.active&&(t.save(),e.isPopping?this.drawPoppingBubble(t,e):this.drawBubble(t,e),t.restore())})}drawBubble(t,e){e.isTarget&&this.config.visuals.effects.glow.enabled&&(t.globalAlpha=.5*e.glowIntensity,t.fillStyle=this.config.visuals.colors.correctGlow,t.beginPath(),t.arc(e.x,e.y,e.size/2+10,0,2*Math.PI),t.fill()),t.globalAlpha=.3,t.fillStyle=this.config.visuals.colors.bubbleShadow,t.beginPath(),t.arc(e.x+2,e.y+2,e.size/2,0,2*Math.PI),t.fill(),t.globalAlpha=.8;const s=t.createRadialGradient(e.x-e.size/4,e.y-e.size/4,0,e.x,e.y,e.size/2);s.addColorStop(0,this.config.visuals.colors.bubbleHighlight),s.addColorStop(1,this.config.visuals.colors.bubbleBase),t.fillStyle=s,t.beginPath(),t.arc(e.x,e.y,e.size/2,0,2*Math.PI),t.fill(),t.globalAlpha=.9,t.fillStyle=this.config.visuals.colors.bubbleHighlight,t.beginPath(),t.arc(e.x-e.size/4,e.y-e.size/4,e.size/8,0,2*Math.PI),t.fill(),this.config.visuals.effects.shimmer.enabled&&(t.globalAlpha=.4+.2*Math.sin(this.shimmerPhase+e.shimmerOffset),t.fillStyle=this.config.visuals.colors.bubbleHighlight,t.beginPath(),t.arc(e.x+e.size/6,e.y-e.size/6,e.size/12,0,2*Math.PI),t.fill()),t.globalAlpha=1,t.fillStyle=this.config.visuals.colors.letterColor,t.font=`bold ${e.size/2}px Arial`,t.textAlign="center",t.textBaseline="middle",t.fillText(e.letter,e.x,e.y)}drawPoppingBubble(t,e){const s=e.popAnimation,i=1+.5*s,a=1-s;t.globalAlpha=a,t.scale(i,i),t.fillStyle=this.config.visuals.colors.bubbleBase,t.beginPath(),t.arc(e.x/i,e.y/i,e.size/2/i,0,2*Math.PI),t.fill(),t.fillStyle=this.config.visuals.colors.letterColor,t.font=`bold ${e.size/2/i}px Arial`,t.textAlign="center",t.textBaseline="middle",t.fillText(e.letter,e.x/i,e.y/i)}reset(){this.bubbles.forEach(t=>this.deactivateBubble(t)),this.bubbles=[],this.activeBubbles=0,this.streak=0,this.combo=0,this.lastCorrectTime=0,this.lastSpawnTime=0,this.time=0,this.shimmerPhase=0}cleanup(){this.removeEventListeners(),this.reset()}}class C extends m{constructor(t,e,s,i){super(t,e,s,i),this.config=M,this.bubbleSystem=null,this.currentDifficulty="easy",this.targetLetter="A",this.correctCount=0,this.totalAttempts=0,this.streak=0,this.timeRemaining=this.config.education.progression.levelDuration,this.gameStartTime=0,this.showingInstructions=!0,this.celebrationTime=0,this.instructionAlpha=1,this.backgroundGradient=null,this.lastFrameTime=0,this.frameCount=0,this.avgFPS=60,this.backgroundPhase=0,this.targetLetterPulse=0,this.onCorrectAnswer=this.onCorrectAnswer.bind(this),this.onWrongAnswer=this.onWrongAnswer.bind(this)}async init(){console.log("ü´ß Initializing Phonics Level..."),this.bubbleSystem=new P(this.canvas,this.ctx,this.managers.particleManager,this.managers.sound),this.bubbleSystem.onCorrectAnswer=this.onCorrectAnswer,this.bubbleSystem.onWrongAnswer=this.onWrongAnswer,this.setDifficulty(this.currentDifficulty),this.setNewTarget(),this.createBackgroundGradient(),await this.managers.sound.resumeContext(),this.showInstructions(),console.log("‚úÖ Phonics Level initialized successfully!")}createBackgroundGradient(){this.backgroundGradient=this.ctx.createLinearGradient(0,0,0,this.canvas.height),this.backgroundGradient.addColorStop(0,"#e3f2fd"),this.backgroundGradient.addColorStop(.5,"#f8f9fa"),this.backgroundGradient.addColorStop(1,"#fff3e0")}setDifficulty(t){this.currentDifficulty=t,this.bubbleSystem&&this.bubbleSystem.setDifficulty(t),console.log(`üìä Difficulty set to: ${t}`)}setNewTarget(){const t=this.config.education.difficulty[this.currentDifficulty].letters;this.targetLetter=t[Math.floor(Math.random()*t.length)],this.bubbleSystem&&this.bubbleSystem.setTargetLetter(this.targetLetter),this.managers.sound.playPhonicsSound(this.targetLetter,.8),console.log(`üéØ New target letter: ${this.targetLetter}`)}showInstructions(){this.showingInstructions=!0,this.instructionAlpha=1,setTimeout(()=>{this.hideInstructions()},3e3)}hideInstructions(){this.showingInstructions=!1,this.gameStartTime=performance.now(),this.timeRemaining=this.config.education.progression.levelDuration}onCorrectAnswer(t,e){this.correctCount++,this.totalAttempts++,this.streak++,this.updateScore(e);const s=this.config.education.difficulty[this.currentDifficulty].targetCount;this.correctCount>=s?this.advanceDifficulty():this.setNewTarget(),this.showCelebration(),this.managers.hud&&this.managers.hud.updateStats(`Target: ${this.targetLetter} | Streak: ${this.streak} | ${this.correctCount}/${s}`),console.log(`‚úÖ Correct! ${t} - Score: ${e}, Streak: ${this.streak}`)}onWrongAnswer(t,e){this.totalAttempts++,this.streak=0,this.updateScore(e),setTimeout(()=>{this.managers.sound.playPhonicsSound(this.targetLetter,.8)},this.config.gameplay.pauseOnWrong),this.managers.hud&&this.managers.hud.updateStats(`Target: ${this.targetLetter} | Streak: ${this.streak} | ${this.correctCount}/${this.config.education.difficulty[this.currentDifficulty].targetCount}`),console.log(`‚ùå Wrong! ${t} - Penalty: ${e}, Target was: ${this.targetLetter}`)}advanceDifficulty(){const t=["easy","medium","hard"],e=t.indexOf(this.currentDifficulty);e<t.length-1?(this.currentDifficulty=t[e+1],this.setDifficulty(this.currentDifficulty),this.correctCount=0,this.setNewTarget(),this.showAdvancementMessage(),console.log(`üéâ Advanced to ${this.currentDifficulty} difficulty!`)):this.completeLevel()}showCelebration(){this.celebrationTime=this.config.gameplay.celebrationDuration,this.createCelebrationParticles()}showAdvancementMessage(){this.managers.checkpoint&&this.managers.checkpoint.showCheckpoint(`Level Up!<br>Now playing: ${this.currentDifficulty.toUpperCase()} mode`)}createCelebrationParticles(){const t=this.canvas.width/2,e=this.canvas.height/2;for(let s=0;s<20;s++){const i=s/20*Math.PI*2,a=3+5*Math.random(),n=Math.cos(i)*a,o=Math.sin(i)*a,r=2+4*Math.random(),h=1e3+1e3*Math.random();this.managers.particleManager.createParticle(t,e,this.config.visuals.colors.correctGlow,r,n,o,h)}}completeLevel(){console.log("üéâ Level completed!");const t=this.correctCount/Math.max(1,this.totalAttempts),e=10*Math.floor(this.timeRemaining/1e3),s=Math.floor(500*t);this.updateScore(e+s),this.managers.checkpoint&&this.managers.checkpoint.showCheckpoint(`Phonics Master!<br>Accuracy: ${Math.floor(100*t)}%<br>Time Bonus: ${e}<br>Accuracy Bonus: ${s}`),setTimeout(()=>{this.end()},3e3)}update(t){this.running&&(this.updatePerformanceStats(t),this.updateVisualEffects(t),this.updateGameTimer(t),this.bubbleSystem&&this.bubbleSystem.update(t),this.showingInstructions&&this.updateInstructions(t),this.celebrationTime>0&&(this.celebrationTime-=t),this.checkLevelCompletion())}updatePerformanceStats(t){this.frameCount++;const e=performance.now();e-this.lastFrameTime>=1e3&&(this.avgFPS=this.frameCount,this.frameCount=0,this.lastFrameTime=e,this.avgFPS<45?this.reducedQuality=!0:this.avgFPS>55&&(this.reducedQuality=!1))}updateVisualEffects(t){this.backgroundPhase+=.001*t,this.targetLetterPulse+=.005*t}updateGameTimer(t){!this.showingInstructions&&this.timeRemaining>0&&(this.timeRemaining-=t,this.timeRemaining<=0&&(this.timeRemaining=0,this.completeLevel()))}updateInstructions(t){this.instructionAlpha>0&&(this.instructionAlpha-=t/1e3,this.instructionAlpha=Math.max(0,this.instructionAlpha))}checkLevelCompletion(){"hard"===this.currentDifficulty&&this.correctCount>=this.config.education.difficulty.hard.targetCount&&this.completeLevel()}render(){this.running&&(this.drawBackground(),this.bubbleSystem&&this.bubbleSystem.draw(this.ctx),this.drawUI(),this.showingInstructions&&this.drawInstructions(),this.celebrationTime>0&&this.drawCelebration(),this.showDebugInfo&&this.drawDebugInfo())}drawBackground(){this.ctx.fillStyle=this.backgroundGradient,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.save(),this.ctx.globalAlpha=.1;for(let t=0;t<5;t++){const e=(.2*t+.1)*this.canvas.width,s=.5*this.canvas.height+50*Math.sin(this.backgroundPhase+t),i=20+10*Math.sin(.5*this.backgroundPhase+t);this.ctx.fillStyle=this.config.visuals.colors.bubbleBase,this.ctx.beginPath(),this.ctx.arc(e,s,i,0,2*Math.PI),this.ctx.fill()}this.ctx.restore()}drawUI(){this.ctx.save(),this.drawTargetLetter(),this.drawProgress(),this.drawTimer(),this.drawScoreInfo(),this.ctx.restore()}drawTargetLetter(){const t=this.canvas.width/2;this.ctx.fillStyle="rgba(255, 255, 255, 0.9)",this.ctx.fillRect(t-60,40,120,80),this.ctx.strokeStyle=this.config.visuals.colors.correctGlow,this.ctx.lineWidth=3,this.ctx.strokeRect(t-60,40,120,80),this.ctx.fillStyle=this.config.visuals.colors.letterColor,this.ctx.font="bold 16px Arial",this.ctx.textAlign="center",this.ctx.fillText("Find:",t,60);const e=1+.1*Math.sin(this.targetLetterPulse);this.ctx.save(),this.ctx.scale(e,e),this.ctx.fillStyle=this.config.visuals.colors.letterColor,this.ctx.font="bold 32px Arial",this.ctx.textAlign="center",this.ctx.fillText(this.targetLetter,t/e,95/e),this.ctx.restore()}drawProgress(){const t=this.config.education.difficulty[this.currentDifficulty].targetCount,e=this.correctCount/t,s=this.canvas.width/2-100;this.ctx.fillStyle="rgba(0, 0, 0, 0.2)",this.ctx.fillRect(s,150,200,20),this.ctx.fillStyle=this.config.visuals.colors.correctGlow,this.ctx.fillRect(s,150,200*e,20),this.ctx.fillStyle=this.config.visuals.colors.letterColor,this.ctx.font="bold 14px Arial",this.ctx.textAlign="center",this.ctx.fillText(`${this.correctCount}/${t} - ${this.currentDifficulty.toUpperCase()}`,this.canvas.width/2,185)}drawTimer(){const t=`${Math.floor(this.timeRemaining/6e4)}:${Math.floor(this.timeRemaining%6e4/1e3).toString().padStart(2,"0")}`;this.ctx.fillStyle=this.config.visuals.colors.letterColor,this.ctx.font="bold 18px Arial",this.ctx.textAlign="right",this.ctx.fillText(t,this.canvas.width-20,30)}drawScoreInfo(){this.ctx.fillStyle=this.config.visuals.colors.letterColor,this.ctx.font="bold 16px Arial",this.ctx.textAlign="left",this.ctx.fillText(`Score: ${this.score}`,20,30),this.streak>0&&(this.ctx.fillStyle=this.config.visuals.colors.correctGlow,this.ctx.fillText(`Streak: ${this.streak}`,20,55))}drawInstructions(){this.instructionAlpha<=0||(this.ctx.save(),this.ctx.globalAlpha=this.instructionAlpha,this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="white",this.ctx.font="bold 24px Arial",this.ctx.textAlign="center",this.ctx.fillText("Phonics Bubbles",this.canvas.width/2,this.canvas.height/2-80),this.ctx.font="18px Arial",this.ctx.fillText("Pop the bubbles with the target letter!",this.canvas.width/2,this.canvas.height/2-40),this.ctx.fillText("Listen to the letter sounds and learn!",this.canvas.width/2,this.canvas.height/2-10),this.ctx.fillText("Click or tap to start...",this.canvas.width/2,this.canvas.height/2+40),this.ctx.restore())}drawCelebration(){const t=this.celebrationTime/this.config.gameplay.celebrationDuration;this.ctx.save(),this.ctx.globalAlpha=.5*t;const e=this.ctx.createRadialGradient(this.canvas.width/2,this.canvas.height/2,0,this.canvas.width/2,this.canvas.height/2,200);e.addColorStop(0,this.config.visuals.colors.correctGlow),e.addColorStop(1,"transparent"),this.ctx.fillStyle=e,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.restore()}drawDebugInfo(){this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(10,this.canvas.height-100,200,90),this.ctx.fillStyle="white",this.ctx.font="12px Arial",this.ctx.textAlign="left",this.ctx.fillText(`FPS: ${this.avgFPS}`,15,this.canvas.height-80),this.ctx.fillText(`Bubbles: ${this.bubbleSystem?this.bubbleSystem.activeBubbles:0}`,15,this.canvas.height-65),this.ctx.fillText(`Target: ${this.targetLetter}`,15,this.canvas.height-50),this.ctx.fillText(`Difficulty: ${this.currentDifficulty}`,15,this.canvas.height-35),this.ctx.fillText(`Progress: ${this.correctCount}`,15,this.canvas.height-20)}handleInput(){this.showingInstructions&&this.hideInstructions()}pause(){super.pause(),this.bubbleSystem&&this.bubbleSystem.removeEventListeners()}resume(){super.resume(),this.bubbleSystem&&this.bubbleSystem.setupEventListeners()}reset(){super.reset(),this.currentDifficulty="easy",this.correctCount=0,this.totalAttempts=0,this.streak=0,this.timeRemaining=this.config.education.progression.levelDuration,this.celebrationTime=0,this.bubbleSystem&&(this.bubbleSystem.reset(),this.bubbleSystem.setDifficulty(this.currentDifficulty)),this.showingInstructions=!0,this.instructionAlpha=1,this.setNewTarget()}cleanup(){super.cleanup(),this.bubbleSystem&&this.bubbleSystem.cleanup()}get accuracy(){return this.correctCount/Math.max(1,this.totalAttempts)}get progress(){const t=this.config.education.difficulty[this.currentDifficulty].targetCount;return this.correctCount/t}get levelInfo(){return{name:"Phonics Bubbles",difficulty:this.currentDifficulty,progress:this.progress,accuracy:this.accuracy,score:this.score,streak:this.streak}}}class E{constructor(t,e){this.container=document.getElementById(t),this.onSelect=e,this.progressManager=new f,this.levels=[{name:"colors",label:"Colors Level",description:"Match the target color from memory",difficulty:"‚òÖ‚òÜ‚òÜ"},{name:"shapes",label:"Shapes Level",description:"Target shapes in sequence",difficulty:"‚òÖ‚òÖ‚òÜ"},{name:"alphabet",label:"Alphabet Level",description:"A through Z in order",difficulty:"‚òÖ‚òÖ‚òÜ"},{name:"numbers",label:"Numbers Level",description:"1 through 10 in order",difficulty:"‚òÖ‚òÖ‚òÜ"},{name:"clcase",label:"Case Level",description:"a through z in order",difficulty:"‚òÖ‚òÖ‚òÖ"},{name:"phonics",label:"Phonics Bubbles",description:"Pop bubbles and learn letter sounds! ü´ß",difficulty:"‚òÖ‚òÜ‚òÜ"}]}show(){const t=this.progressManager.getProgress(),e=['<div class="level-menu">',"<h2>Select Level</h2>",'<div class="progress-summary">',`<p>Completion: ${this.progressManager.getCompletionPercentage()}%</p>`,`<p>Total Score: ${t.totalScore}</p>`,"</div>",'<div class="level-grid">',this.levels.map(t=>{const e=this.progressManager.isLevelUnlocked(t.name),s=this.progressManager.isLevelCompleted(t.name),i=this.progressManager.getLevelScore(t.name),a=s?"‚úì":e?"‚óè":"üîí";return`\n          <div class="level-card ${s?"completed":e?"unlocked":"locked"}" ${e?`data-level="${t.name}"`:""}>\n            <div class="level-status">${a}</div>\n            <h3>${t.label}</h3>\n            <p class="level-description">${t.description}</p>\n            <p class="level-difficulty">Difficulty: ${t.difficulty}</p>\n            ${s?`<p class="level-score">Best: ${i}</p>`:""}\n            ${e?"":'<p class="level-locked">Complete previous level to unlock</p>'}\n          </div>\n        `}).join(""),"</div>",'<div class="menu-actions">','<button class="back-button">Back</button>','<button class="reset-button">Reset Progress</button>',"</div>","</div>"].join("");this.container.innerHTML=e,this.container.style.display="flex",this.levels.forEach(t=>{const e=this.container.querySelector(`[data-level="${t.name}"]`);e&&(e.addEventListener("click",()=>this.selectLevel(t.name)),e.style.cursor="pointer")});const s=this.container.querySelector(".back-button");s&&s.addEventListener("click",()=>this.back());const i=this.container.querySelector(".reset-button");i&&i.addEventListener("click",()=>this.resetProgress())}selectLevel(t){this.progressManager.isLevelUnlocked(t)&&"function"==typeof this.onSelect&&(this.container.style.display="none",this.onSelect(t))}resetProgress(){confirm("Are you sure you want to reset all progress? This cannot be undone.")&&(this.progressManager.resetProgress(),this.show())}back(){window.location.reload()}}class T{constructor(t){this.canvas=t,this.pointerDownListeners=[],this.pointerUpListeners=[],this.pointerMoveListeners=[],this.keyDownListeners=[],this._boundHandlePointerDown=t=>this._handlePointerDown(t),this._boundHandlePointerUp=t=>this._handlePointerUp(t),this._boundHandlePointerMove=t=>this._handlePointerMove(t),this._boundHandleKeyDown=t=>this._handleKeyDown(t),t.addEventListener("pointerdown",this._boundHandlePointerDown),t.addEventListener("pointerup",this._boundHandlePointerUp),t.addEventListener("pointermove",this._boundHandlePointerMove),window.addEventListener("keydown",this._boundHandleKeyDown)}_handlePointerDown(t){const e=this._getPointerPosition(t);this.pointerDownListeners.forEach(s=>s(e,t))}_handlePointerUp(t){const e=this._getPointerPosition(t);this.pointerUpListeners.forEach(s=>s(e,t))}_handlePointerMove(t){const e=this._getPointerPosition(t);this.pointerMoveListeners.forEach(s=>s(e,t))}_handleKeyDown(t){this.keyDownListeners.forEach(e=>e(t.code,t))}_getPointerPosition(t){if(!this.canvas)return console.warn("Canvas not available for pointer position calculation"),{x:0,y:0};const e=this.canvas.getBoundingClientRect();if(!e)return console.warn("Could not get canvas bounding rect"),{x:0,y:0};const s=e.width>0?this.canvas.width/e.width:1,i=e.height>0?this.canvas.height/e.height:1;return{x:(t.clientX-e.left)*s,y:(t.clientY-e.top)*i}}onPointerDown(t){this.pointerDownListeners.push(t)}onPointerUp(t){this.pointerUpListeners.push(t)}onPointerMove(t){this.pointerMoveListeners.push(t)}onKeyDown(t){this.keyDownListeners.push(t)}destroy(){this.canvas&&(this.canvas.removeEventListener("pointerdown",this._boundHandlePointerDown),this.canvas.removeEventListener("pointerup",this._boundHandlePointerUp),this.canvas.removeEventListener("pointermove",this._boundHandlePointerMove)),window.removeEventListener("keydown",this._boundHandleKeyDown),this.pointerDownListeners=[],this.pointerUpListeners=[],this.pointerMoveListeners=[],this.keyDownListeners=[],this.canvas=null}}function L(){const t=function(){const t=window.innerWidth,e=window.innerHeight;return t>2560&&e>1440?"QBOARD":"DEFAULT"}();return{fontSizes:a.FONT_SIZES[t],maxParticles:a.MAX_PARTICLES[t],maxExplosions:a.MAX_EXPLOSIONS[t],motherRadius:a.MOTHER_RADIUS[t],collisionFrequency:a.COLLISION_CHECK_FREQUENCY[t]}}class I{constructor(t,e,s){this.canvas=t,this.bgCanvas=document.createElement("canvas"),this.bgCanvas.className="welcome-bg-canvas",this.bgCtx=this.bgCanvas.getContext("2d"),this.syncCanvasSize(),this.resourceManager=s,this.particles=[],this.animationId=null,this.isVisible=!1,this.time=0,this.maxParticles=150,this.particleSpeed=.5,this.onStartGame=null,this.onShowOptions=null,this.particleColors=["#ff595e","#ffca3a","#8ac926","#1982c4","#6a4c93"],this.setupParticles(),this.setupUI(),window.addEventListener("resize",()=>this.onResize())}setupParticles(){for(let t=0;t<this.maxParticles;t++)this.particles.push({x:Math.random()*this.bgCanvas.width,y:Math.random()*this.bgCanvas.height,size:6*Math.random()+2,speed:Math.random()*this.particleSpeed+.3,opacity:.9*Math.random()+.1,color:this.particleColors[Math.floor(Math.random()*this.particleColors.length)]})}setupUI(){this.createWelcomeScreenHTML(),this.attachEventListeners()}createWelcomeScreenHTML(){const t=document.getElementById("welcome-screen");t&&t.remove();const e=document.createElement("div");e.id="welcome-screen",e.className="welcome-screen-overlay",e.appendChild(this.bgCanvas),e.innerHTML+='\n      <div class="welcome-content">\n        <h1 class="game-title">Super Student</h1>\n        <div class="display-size-section">\n          <p class="choose-text">Choose Display Size</p>\n          <div class="display-btn-group">\n            <button class="display-btn default" data-mode="DEFAULT">Default</button>\n            <button class="display-btn qboard" data-mode="QBOARD">QBoard</button>\n          </div>\n          <p class="mode-selected-text" style="display:none;"></p>\n        </div>\n        <footer class="collaboration-footer">\n          <p>In collaboration with <span class="highlight">SANGSOM Kindergarten</span></p>\n        </footer>\n      </div>',document.body.appendChild(e),this.addWelcomeScreenCSS()}addWelcomeScreenCSS(){const t=document.createElement("style");t.textContent="\n      .welcome-screen-overlay {\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100vw;\n        height: 100vh;\n        background: rgba(0,0,0,0.8);\n        backdrop-filter: blur(2px);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        z-index: 1000;\n        opacity: 0;\n        transition: opacity 0.5s ease-in-out;\n      }\n      .welcome-screen-overlay.visible { opacity:1; }\n      .welcome-content { text-align:center; color:white; max-width:90vw; }\n      .game-title { font-size:10vw; margin:0 0 40px 0; color:#ffd700; font-weight:900; text-shadow:3px 3px 8px rgba(0,0,0,0.6); }\n      .choose-text { font-size:1.2rem; margin-bottom:16px; letter-spacing:1px; }\n      .display-btn-group { display:flex; gap:40px; justify-content:center; flex-wrap:wrap; margin-bottom:30px; }\n      .display-btn {\n        width:200px; height:60px; font-size:1.1rem; font-weight:600; background:transparent; border:3px solid currentColor; color:white; cursor:pointer; transition:transform 0.2s, opacity 0.3s;\n      }\n      .display-btn.default { color:#00bfff; }\n      .display-btn.qboard { color:#ff4080; }\n      .display-btn:hover { transform:translateY(-4px); }\n      .display-btn.selected { opacity:0.6; cursor:default; }\n      .collaboration-footer { position:absolute; bottom:40px; left:50%; transform:translateX(-50%); font-size:2vw; }\n      .highlight { color:#ffd700; }\n      @media(max-width:768px){ .game-title { font-size:12vw; } .display-btn { width:160px; height:50px; } .collaboration-footer{ font-size:4vw;} }\n      /* Background canvas */\n      .welcome-bg-canvas { position:absolute; top:0; left:0; width:100%; height:100%; z-index:-1; }\n    ",document.head.appendChild(t)}attachEventListeners(){const t=t=>{document.querySelectorAll(".display-btn").forEach(t=>t.classList.remove("selected")),t.classList.add("selected");const e=t.dataset.mode;this.resourceManager.setDisplayMode(e);const s=document.querySelector(".mode-selected-text");s&&(s.style.display="block",s.textContent=`Display mode set to ${e}. Loading...`),setTimeout(()=>{this.onStartGame&&(this.hide(),this.onStartGame())},1200)};setTimeout(()=>{document.querySelectorAll(".display-btn").forEach(e=>{e.addEventListener("click",()=>t(e))})},100)}show(){this.isVisible=!0,this.startAnimation(),setTimeout(()=>{const t=document.getElementById("welcome-screen");t&&t.classList.add("visible")},100)}hide(){this.isVisible=!1,this.stopAnimation();const t=document.getElementById("welcome-screen");t&&(t.classList.remove("visible"),setTimeout(()=>{t.remove()},500))}startAnimation(){if(this.animationId)return;const t=()=>{this.isVisible&&(this.updateAnimatedBackground(),this.renderAnimatedBackground(),this.animationId=requestAnimationFrame(t))};t()}stopAnimation(){this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null)}updateAnimatedBackground(){this.time+=.01,this.particles.forEach(t=>{t.y-=t.speed,t.y<-10&&(t.y=this.bgCanvas.height+10,t.x=Math.random()*this.bgCanvas.width),t.opacity=.5+.3*Math.sin(.1*this.time)})}renderAnimatedBackground(){const t=this.bgCtx;t.fillStyle="rgba(0,0,0,0.9)",t.fillRect(0,0,this.bgCanvas.width,this.bgCanvas.height),this.particles.forEach(e=>{t.save(),t.globalAlpha=e.opacity,t.fillStyle=e.color,t.beginPath(),t.arc(e.x,e.y,e.size,0,2*Math.PI),t.fill(),t.restore()})}onResize(){this.syncCanvasSize(),this.particles.forEach(t=>{t.x>this.bgCanvas.width&&(t.x=Math.random()*this.bgCanvas.width),t.y>this.bgCanvas.height&&(t.y=Math.random()*this.bgCanvas.height)})}syncCanvasSize(){this.bgCanvas.width=window.innerWidth,this.bgCanvas.height=window.innerHeight}setCallbacks(t,e){this.onStartGame=t,this.onShowOptions=e}}function A(t={}){const{overlay:e=!0,logger:s=console.error}=t,i=[];let a=null;function n(t,n,o,r,h,c){const l={type:t,message:n,source:o,lineno:r,colno:h,stack:c&&c.stack,timestamp:Date.now()};i.push(l);const d=`[${new Date(l.timestamp).toLocaleTimeString()}] ${t}: ${n}${o?` (${o}:${r}:${h})`:""}`;s(d),c&&c.stack&&s(c.stack),function(t){if(!e)return;a||(a=document.createElement("div"),a.id="error-overlay",a.style.cssText="\n        position: fixed;\n        top: 0;\n        left: 0;\n        right: 0;\n        z-index: 99999;\n        background: rgba(200, 0, 0, 0.9);\n        color: #fff;\n        font: 12px/1.4 monospace;\n        max-height: 200px;\n        overflow-y: auto;\n        padding: 6px 8px;\n        white-space: pre-wrap;",document.body.appendChild(a));const s=document.createElement("div");s.textContent=t,a.appendChild(s)}(d)}return window.addEventListener("error",t=>{n("Error",t.message,t.filename,t.lineno,t.colno,t.error)}),window.addEventListener("unhandledrejection",t=>{n("Unhandled Promise",t.reason?.message||String(t.reason),"",0,0,t.reason)}),{getErrors:()=>i.slice(),clear(){i.length=0,a&&(a.innerHTML="")}}}let O,D,_,F,k,R,B,z,N,j,G={},U=null,$="menu";function V(){D.setupCanvas(),G.hud&&G.hud.resize(D.canvas),G.centerPiece&&G.centerPiece.resize(D.canvas),U&&"function"==typeof U.resize&&U.resize(D.canvas)}function q(){console.log("üéÆ Showing level menu..."),j&&j.hide();const t=document.createElement("div");t.id="level-menu-container",t.style.cssText="\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100vw;\n    height: 100vh;\n    background: rgba(0, 0, 0, 0.9);\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    z-index: 1000;\n    color: white;\n  ",document.body.appendChild(t);new E("level-menu-container",X).show(),$="menu"}function X(t){console.log(`üéØ Starting level: ${t}`);const e=document.getElementById("level-menu-container");e&&e.remove(),$="playing",G.hud=new c(O,_),G.checkpoint=new l(O,_),G.flamethrower=new d(O,_,R),G.centerPiece=new u(O,_,R),G.multiTouch=new p(O),G.glassShatter=new g(O,_,R),G.particleManager=R,G.sound=B;const s={createExplosion:(t,e,s,i)=>{const a=Math.floor(20*i);for(let n=0;n<a;n++){const i=Math.random()*Math.PI*2,a=2+4*Math.random(),n=Math.cos(i)*a,o=Math.sin(i)*a,r=2+3*Math.random(),h=500+1e3*Math.random();R.createParticle(t,e,s,r,n,o,h)}},applyExplosionEffect:(t,e,s,i)=>{G.glassShatter.triggerShatter(t,e,.5*i)},onLevelComplete:e=>{!function(t,e){z.completeLevel(t,e),$="completed",G.checkpoint.showCheckpoint(`Level Complete!<br>Score: ${e}<br>Next level unlocked!`),setTimeout(()=>{q()},3e3)}(t,e)}};switch(performance.now(),t){case"colors":default:U=new v(O,_,G,s);break;case"shapes":U=new y(O,_,G,s);break;case"alphabet":U=new x(O,_,G,s);break;case"numbers":U=new w(O,_,G,s);break;case"clcase":U=new S(O,_,G,s);break;case"phonics":U=new C(O,_,G,s)}U.start()}function W(){const t=document.getElementById("settings-modal");t.innerHTML='\n    <div class="modal-background"></div>\n    <div class="modal-content">\n      <h2>Options</h2>\n      <label>Display Mode:</label>\n      <select id="display-mode-select">\n        <option value="DEFAULT">Default</option>\n        <option value="QBOARD">QBoard</option>\n      </select>\n      <label>Volume:</label>\n      <input type="range" id="volume-range" min="0" max="1" step="0.01">\n      <button id="save-options">Save</button>\n      <button id="close-options">Close</button>\n    </div>\n  ',t.style.display="block";const e=document.getElementById("display-mode-select");e.value=k.getDisplayMode(),document.getElementById("volume-range").value=B.volume,document.getElementById("save-options").addEventListener("click",()=>{k.setDisplayMode(e.value),B.setGlobalVolume(parseFloat(document.getElementById("volume-range").value)),t.style.display="none"}),document.getElementById("close-options").addEventListener("click",()=>{t.style.display="none"})}function Y(){window.addEventListener("keydown",t=>{switch(t.code){case"Space":t.preventDefault(),"playing"===$&&("playing"===$?H():"paused"===$&&Q());break;case"KeyR":"gameOver"!==$&&"paused"!==$||($="playing",U&&(U.reset(),U.start()));break;case"Escape":"playing"===$?H():"paused"===$&&Q()}}),O.addEventListener("contextmenu",t=>t.preventDefault())}function H(){"playing"===$&&($="paused",U&&U.pause(),G.checkpoint.showCheckpoint("Game Paused"))}function Q(){"paused"===$&&($="playing",U&&U.resume())}function K(t){"playing"===$&&U&&U.update(t),G.centerPiece&&G.centerPiece.update(t),G.flamethrower&&G.flamethrower.update(t),G.glassShatter&&G.glassShatter.update(t),G.hud&&G.hud.update(t),G.checkpoint&&G.checkpoint.update(t)}function Z(){D.clear(),"playing"===$&&U&&U.render(),G.centerPiece&&G.centerPiece.draw(_),G.particleManager&&G.particleManager.updateAndDraw(_,N?N.lastDeltaTime:16),G.flamethrower&&G.flamethrower.draw(_),G.glassShatter&&G.glassShatter.draw(_),G.hud&&G.hud.draw(_),G.checkpoint&&G.checkpoint.draw(_)}window.addEventListener("resize",V),window.onload=async()=>{console.log("üéÆ Super Student: Starting initialization...");try{if(O=document.getElementById("game-canvas"),!O)throw new Error('Canvas element with id "game-canvas" not found!');D=new r(O),_=D.ctx,console.log("‚úÖ Canvas and renderer initialized"),V(),console.log("‚úÖ Canvas resized"),F=L(),console.log("‚úÖ Display settings loaded"),k=new s,R=new i(F.maxParticles),B=new o,z=new f,console.log("‚úÖ Core managers initialized"),G.input=new T(O),console.log("‚úÖ Input handler setup");let e={};try{e=await k.initializeGameResources(),console.log("‚úÖ Resources loaded successfully"),e.audio&&(B.sounds=e.audio,B.setGlobalVolume(B.volume))}catch(t){console.error("‚ö†Ô∏è Failed to load resources:",t)}const a=n();B.setGlobalVolume(a.masterVolume),console.log("‚úÖ Audio configured"),G.displaySettings=F,N=new h(K,Z),N.start(),console.log("‚úÖ Game loop started"),console.log("üéØ Showing welcome screen..."),j=new I(O,_,k),j.setCallbacks(q,W),j.show(),Y(),console.log("‚úÖ Welcome screen should be visible now!"),A()}catch(t){console.error("‚ùå CRITICAL ERROR during initialization:",t),console.error("Stack trace:",t.stack)}};
//# sourceMappingURL=main-DvwAzL84.js.map
